(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[919],{1314:function(e,t,a){Promise.resolve().then(a.bind(a,5264))},5264:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var r=a(7437),n=a(2869),s=a(2451),l=a(9862),i=a(7168);let o=(0,a(9205).Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var c=a(759),u=a(9512),d=a(8444),f=a(2265),h=a(9376),m=a(6023),x=a(6281),p=a(9116);function g(){let{t:e}=(0,c.Z)(),t=(0,h.useRouter)(),a=(0,h.useSearchParams)(),{authInfo:g,isAuthenticated:v}=(0,x.a)(),y=(0,f.useRef)(null),[j,w]=(0,f.useState)({avatar:null,nickname:"",avatarPreview:""}),[b,k]=(0,f.useState)(""),[N,I]=(0,f.useState)(""),[S,z]=(0,f.useState)(!1),[E,U]=(0,f.useState)(!1),[Z,P]=(0,f.useState)({email:"",userId:"",token:""}),[C,M]=(0,f.useState)(!1),[A,F]=(0,f.useState)(!1),_="/img/avatar.png",L="User";(0,f.useEffect)(()=>{let e=a.get("from");M("register"===e),v&&g?(P({email:g.email,userId:g.userId,token:g.token}),"register"!==e?R(g.email,g.userId,g.token):T()):T()},[a,v,g]);let R=async(e,t,a)=>{U(!0);try{let r=await (0,m.bG)({email:e,userId:t,token:a});r.success&&r.data&&w(e=>({...e,nickname:r.data.nickname||"",avatarPreview:(0,p.nJ)(r.data.avatar,"")}))}catch(e){console.log("Failed to load user info:",e),T()}finally{U(!1)}},T=()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="";for(let a=0;a<8;a++)t+=e.charAt(Math.floor(Math.random()*e.length));w({...j,nickname:t})},q=async a=>{a.preventDefault(),z(!0),k(""),I("");try{let a=j.nickname||L,n=j.avatarPreview||_;if(Z.email&&Z.userId&&Z.token){if(j.avatar){F(!0);try{var r;let t=await (0,m.gg)(j.avatar);if(t.success&&(null===(r=t.data)||void 0===r?void 0:r.img))n=t.data.img;else{k(e("auth.avatarUploadError"));return}}catch(t){k(e("auth.avatarUploadError"));return}finally{F(!1)}}let s=await (0,m.gS)(Z.email,Z.userId,Z.token,a,n,"en");s.success?(I(e("auth.updateUserInfoSuccess")),setTimeout(()=>{t.push("/personal-center")},2e3)):k(s.message||e("auth.updateUserInfoError"))}else k(e("auth.noAuthInfo"))}catch(t){k(t instanceof Error?t.message:e("auth.updateUserInfoError"))}finally{z(!1)}},D=async()=>{if(!Z.email||!Z.userId||!Z.token){k(e("auth.noAuthInfo"));return}z(!0),k(""),I("");try{F(!0);let r=_;try{let e=await O();if(e){var a;let t=await (0,m.gg)(e);t.success&&(null===(a=t.data)||void 0===a?void 0:a.img)&&(r=t.data.img)}}catch(e){console.log("Failed to upload default avatar, using fallback:",e)}finally{F(!1)}let n=await (0,m.gS)(Z.email,Z.userId,Z.token,L,r,"en");n.success?(I(e("auth.updateUserInfoSuccess")),setTimeout(()=>{t.push("/personal-center")},2e3)):k(n.message||e("auth.updateUserInfoError"))}catch(t){k(t instanceof Error?t.message:e("auth.updateUserInfoError"))}finally{z(!1)}},O=async()=>{try{let e=await fetch("/img/avatar.png");if(!e.ok)return null;let t=await e.blob();return new File([t],"avatar.png",{type:"image/png"})}catch(e){return console.log("Failed to load default avatar file:",e),null}};return(0,r.jsx)("div",{className:"min-h-screen w-full flex items-center justify-center bg-white",children:(0,r.jsxs)("main",{className:"w-full flex min-h-[100vh] flex-col",children:[(0,r.jsx)(u.h,{showLanguage:!0}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-2 py-4",children:[(0,r.jsx)("h1",{className:"text-xl font-poppins text-[#11295b]",children:e("personalization.title")}),(0,r.jsx)("button",{onClick:()=>{t.back()},className:"text-[#11295b] hover:text-[#11295b]",children:(0,r.jsx)(s.Z,{className:"w-7 h-7"})})]}),(0,r.jsxs)("form",{onSubmit:q,className:"flex-1 space-y-6 px-2 font-inter",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,r.jsx)("div",{className:"w-48 h-48 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer border-2 border-gray-300 hover:border-[#11295b] transition-colors",onClick:()=>{var e;return null===(e=y.current)||void 0===e?void 0:e.click()},children:j.avatarPreview?(0,r.jsx)("img",{src:j.avatarPreview,alt:"Avatar preview",className:"w-full h-full rounded-full object-cover"}):(0,r.jsx)(l.Z,{className:"w-16 h-16 text-gray-400"})}),(0,r.jsx)("input",{ref:y,type:"file",accept:"image/*",onChange:t=>{var a;let r=null===(a=t.target.files)||void 0===a?void 0:a[0];if(r){if(!r.type.startsWith("image/")){k(e("auth.fileTypeError"));return}if(r.size>5242880){k(e("auth.fileSizeError"));return}let t=new FileReader;t.onload=e=>{var t;w({...j,avatar:r,avatarPreview:null===(t=e.target)||void 0===t?void 0:t.result}),k("")},t.readAsDataURL(r)}},className:"hidden"}),(0,r.jsx)("p",{className:"text-md text-[#11295b] font-bold",children:e("personalization.clickToUpload")})]}),(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsx)("input",{type:"text",value:j.nickname,onChange:e=>w({...j,nickname:e.target.value}),placeholder:e("personalization.nicknamePlaceholder"),className:"w-full rounded-lg bg-gray-100 px-4 py-3 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-[#11295b]/60"})}),b&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-500 text-sm font-inter",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:b})]}),N&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-500 text-sm font-inter",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:N})]}),E&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-blue-500 text-sm font-inter",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4 animate-spin"}),(0,r.jsx)("span",{children:e("common.loading")})]}),(0,r.jsx)(n.z,{type:"submit",className:"w-full bg-[#11295b] text-white shadow-md rounded-lg font-nunito font-bold",size:"lg",disabled:S||A||!!N,children:A?e("auth.avatarUploading"):S?e("personalization.submitting"):N?e("auth.updateUserInfoSuccess"):e("personalization.submit")}),C&&(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsxs)("button",{type:"button",onClick:D,disabled:S||A||!!N,className:"flex items-center text-md font-bold font-nunito ".concat(S||A||N?"text-gray-400 cursor-not-allowed":"text-gray-600 hover:text-gray-800"),children:[A?e("auth.avatarUploading"):S?e("auth.skipping"):e("personalization.skip"),(0,r.jsx)(o,{className:"w-5 h-5 ml-1"})]})})]}),(0,r.jsx)(d.$,{})]})})}},8444:function(e,t,a){"use strict";a.d(t,{$:function(){return c}});var r=a(7437),n=a(759),s=a(2869),l=a(4508);function i(){let{language:e,setLanguage:t,t:a}=(0,n.Z)();return(0,r.jsxs)("div",{className:"flex items-center gap-2 mr-1",children:[(0,r.jsx)(s.z,{variant:"ghost",size:"sm",className:(0,l.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:a("footer.language.en")}),(0,r.jsx)(s.z,{variant:"ghost",size:"sm",className:(0,l.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:a("footer.language.zh")})]})}var o=a(7648);function c(){let{t:e}=(0,n.Z)();return(0,r.jsx)("footer",{className:"mt-auto text-[11px] text-muted-foreground py-2 px-2 w-full font-inter",children:(0,r.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 font-inter",children:(0,r.jsx)(i,{})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,r.jsx)(o.default,{href:"/about",className:"text-muted-foreground font-inter",children:e("footer.links.about")}),(0,r.jsx)(o.default,{href:"/privacy",className:"text-muted-foreground font-inter",children:e("footer.links.privacy")}),(0,r.jsx)("span",{className:"text-muted-foreground font-inter",children:e("footer.copyright")})]})]})})}},2451:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7168:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},function(e){e.O(0,[516,51,282,971,117,744],function(){return e(e.s=1314)}),_N_E=e.O()}]);