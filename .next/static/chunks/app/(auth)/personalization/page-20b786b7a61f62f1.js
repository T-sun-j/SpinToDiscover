(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[919],{1314:function(e,t,a){Promise.resolve().then(a.bind(a,7025))},7025:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var r=a(7437),n=a(2869),s=a(2451),i=a(9205);let l=(0,i.Z)("user-round",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);var o=a(7168);let c=(0,i.Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var u=a(759),d=a(4196),h=a(1839),f=a(2265),m=a(9376),p=a(6023),x=a(6281),g=a(9116);function v(){let{t:e}=(0,u.Z)(),t=(0,m.useRouter)(),a=(0,m.useSearchParams)(),{authInfo:i,isAuthenticated:v}=(0,x.a)(),w=(0,f.useRef)(null),[y,j]=(0,f.useState)({avatar:null,nickname:"",avatarPreview:""}),[k,N]=(0,f.useState)(""),[b,E]=(0,f.useState)(""),[I,S]=(0,f.useState)(!1),[C,U]=(0,f.useState)(!1),[z,F]=(0,f.useState)({email:"",userId:"",token:""}),[Z,A]=(0,f.useState)(!1),[L,P]=(0,f.useState)(!1),M="/img/avatar.png",R="User";(0,f.useEffect)(()=>{let e=a.get("from");A("register"===e),v&&i?(F({email:i.email,userId:i.userId,token:i.token}),"register"!==e?_(i.email,i.userId,i.token):T()):T()},[a,v,i]);let _=async(e,t,a)=>{U(!0);try{let r=await (0,p.bG)({email:e,userId:t,token:a});r.success&&r.data&&j(e=>({...e,nickname:r.data.nickname||"",avatarPreview:(0,g.nJ)(r.data.avatar,"")}))}catch(e){console.log("Failed to load user info:",e),T()}finally{U(!1)}},T=()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="";for(let a=0;a<8;a++)t+=e.charAt(Math.floor(Math.random()*e.length));j({...y,nickname:t})},W=async a=>{a.preventDefault(),S(!0),N(""),E("");try{let a=y.nickname||R,n=y.avatarPreview||M;if(z.email&&z.userId&&z.token){if(y.avatar){P(!0);try{var r;let t=await (0,p.gg)(y.avatar);if(t.success&&(null===(r=t.data)||void 0===r?void 0:r.img))n=t.data.img;else{N(e("auth.avatarUploadError"));return}}catch(t){N(e("auth.avatarUploadError"));return}finally{P(!1)}}let s=await (0,p.gS)(z.email,z.userId,z.token,a,n,"en");s.success?(E(e("auth.updateUserInfoSuccess")),setTimeout(()=>{t.push("/personal-center")},2e3)):N(s.message||e("auth.updateUserInfoError"))}else N(e("auth.noAuthInfo"))}catch(t){N(t instanceof Error?t.message:e("auth.updateUserInfoError"))}finally{S(!1)}},O=async()=>{if(!z.email||!z.userId||!z.token){N(e("auth.noAuthInfo"));return}S(!0),N(""),E("");try{P(!0);let r=M;try{let e=await $();if(e){var a;let t=await (0,p.gg)(e);t.success&&(null===(a=t.data)||void 0===a?void 0:a.img)&&(r=t.data.img)}}catch(e){console.log("Failed to upload default avatar, using fallback:",e)}finally{P(!1)}let n=await (0,p.gS)(z.email,z.userId,z.token,R,r,"en");n.success?(E(e("auth.updateUserInfoSuccess")),setTimeout(()=>{t.push("/personal-center")},2e3)):N(n.message||e("auth.updateUserInfoError"))}catch(t){N(t instanceof Error?t.message:e("auth.updateUserInfoError"))}finally{S(!1)}},$=async()=>{try{let e=await fetch("/img/avatar.png");if(!e.ok)return null;let t=await e.blob();return new File([t],"avatar.png",{type:"image/png"})}catch(e){return console.log("Failed to load default avatar file:",e),null}};return(0,r.jsx)("div",{className:"min-h-screen w-full flex items-center justify-center bg-white ",children:(0,r.jsxs)("main",{className:"w-full flex min-h-[100vh] flex-col",children:[(0,r.jsx)(d.h,{}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-2 py-4 z-100 mx-2",children:[(0,r.jsx)("h1",{className:"text-xl font-poppins text-[#0F1728] font-semibold",children:e("personalization.title")}),(0,r.jsx)("button",{onClick:()=>{t.back()},className:"text-[#0F1728] hover:text-[#0F1728]",children:(0,r.jsx)(s.Z,{className:"w-7 h-7 z-100"})})]}),(0,r.jsxs)("form",{onSubmit:W,className:"flex-1 space-y-6 px-2 font-inter mx-2",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,r.jsx)("div",{className:"w-48 h-48 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer border-2 border-gray-300 hover:border-[#11295b] transition-colors",onClick:()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.click()},children:y.avatarPreview?(0,r.jsx)("img",{src:y.avatarPreview,alt:"Avatar preview",className:"w-full h-full rounded-full object-cover"}):(0,r.jsx)(l,{className:"w-16 h-16 text-gray-400"})}),(0,r.jsx)("input",{ref:w,type:"file",accept:"image/*",onChange:t=>{var a;let r=null===(a=t.target.files)||void 0===a?void 0:a[0];if(r){if(!r.type.startsWith("image/")){N(e("auth.fileTypeError"));return}if(r.size>5242880){N(e("auth.fileSizeError"));return}let t=new FileReader;t.onload=e=>{var t;j({...y,avatar:r,avatarPreview:null===(t=e.target)||void 0===t?void 0:t.result}),N("")},t.readAsDataURL(r)}},className:"hidden"}),(0,r.jsx)("p",{className:"text-[17px] text-[#0F1728] font-nunito",children:e("personalization.clickToUpload")})]}),(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsx)("input",{type:"text",value:y.nickname,onChange:e=>j({...y,nickname:e.target.value}),placeholder:e("personalization.nicknamePlaceholder"),className:"w-full rounded-full bg-gray-100 px-4 py-3 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-[#11295b]/60"})}),k&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-500 text-sm font-inter",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:k})]}),b&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-500 text-sm font-inter",children:[(0,r.jsx)(l,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:b})]}),C&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-blue-500 text-sm font-inter",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 animate-spin"}),(0,r.jsx)("span",{children:e("common.loading")})]}),(0,r.jsx)(n.z,{type:"submit",className:"w-full bg-[#11295b] text-white shadow-md rounded-lg text-[17px] font-poppins font-semibold",size:"lg",disabled:I||L||!!b,children:L?e("auth.avatarUploading"):I?e("personalization.submitting"):b?e("auth.updateUserInfoSuccess"):e("personalization.submit")}),Z&&(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsxs)("button",{type:"button",onClick:O,disabled:I||L||!!b,className:"flex items-center text-[17px] font-semibold font-poppins ".concat(I||L||b?"text-gray-400 cursor-not-allowed":"text-gray-600 hover:text-gray-800"),children:[L?e("auth.avatarUploading"):I?e("auth.skipping"):e("personalization.skip"),(0,r.jsx)(c,{className:"w-5 h-5 ml-1"})]})})]}),(0,r.jsx)(h.$,{})]})})}},1839:function(e,t,a){"use strict";a.d(t,{$:function(){return o}});var r=a(7437),n=a(759),s=a(3145);function i(e){let{transparent:t=!1}=e,{language:a,setLanguage:i}=(0,n.Z)();return(0,r.jsxs)("button",{onClick:()=>{i("en"===a?"zh":"en")},className:"flex items-center ".concat(t?"text-white":"text-[#0F1728]"," hover:opacity-80 transition-opacity"),"aria-label":"Switch to ".concat("en"===a?"Chinese":"English"),children:[(0,r.jsx)(s.default,{src:t?"/img/lang.png":"/img/lang-d.png",alt:"Language",width:24,height:24,className:"h-4 w-4"}),(0,r.jsx)("span",{className:"text-[10px] font-medium ml-1 ".concat(t?"text-white":"text-[#0F1728]"),children:"en"===a?"EN":"CN"})]})}var l=a(7648);function o(e){let{transparent:t=!1}=e,{t:a}=(0,n.Z)();return(0,r.jsx)("footer",{className:"mt-auto text-[10px] py-4 px-4 w-full font-inter ".concat(t?"text-white":"text-[#0F1728]"),children:(0,r.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 font-inter",children:(0,r.jsx)(i,{transparent:t})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,r.jsx)(l.default,{href:"/about",className:"".concat(t?"text-white":"text-[#0F1728]"," font-inter"),children:a("footer.links.about")}),(0,r.jsx)(l.default,{href:"/privacy",className:"".concat(t?"text-white":"text-[#0F1728]"," font-inter"),children:a("footer.links.privacy")}),(0,r.jsx)("span",{className:"".concat(t?"text-white":"text-[#0F1728]"," font-inter"),children:a("footer.copyright")}),(0,r.jsx)(s.default,{src:t?"/img/logo-1.png":"/img/logo-2.png",alt:"Language",width:52,height:22,className:"h-5 w-auto"})]})]})})}},9205:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var r=a(2265);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase()),i=e=>{let t=s(e);return t.charAt(0).toUpperCase()+t.slice(1)},l=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()},o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let u=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:i,className:u="",children:d,iconNode:h,...f}=e;return(0,r.createElement)("svg",{ref:t,...c,width:n,height:n,stroke:a,strokeWidth:i?24*Number(s)/Number(n):s,className:l("lucide",u),...!d&&!o(f)&&{"aria-hidden":"true"},...f},[...h.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(d)?d:[d]])}),d=(e,t)=>{let a=(0,r.forwardRef)((a,s)=>{let{className:o,...c}=a;return(0,r.createElement)(u,{ref:s,iconNode:t,className:l("lucide-".concat(n(i(e))),"lucide-".concat(e),o),...c})});return a.displayName=i(e),a}},2451:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7168:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},function(e){e.O(0,[604,51,624,971,117,744],function(){return e(e.s=1314)}),_N_E=e.O()}]);