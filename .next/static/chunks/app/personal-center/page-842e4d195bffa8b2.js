(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[267],{2990:function(e,t,n){Promise.resolve().then(n.bind(n,156))},156:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var s=n(7437),r=n(2869),l=n(2451),i=n(1817),a=n(9322),c=n(7168),o=n(9205);let d=(0,o.Z)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),u=(0,o.Z)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),f=(0,o.Z)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);var h=n(6937),x=n(759),m=n(9512),g=n(8444),N=n(7648),v=n(3145),p=n(9376),R=n(2265),I=n(7471),j=n(1190),A=n(8685),O=n(9116),_=n(6652),y=n(6281),E=n(2690);function S(){let{t:e}=(0,x.Z)(),t=(0,p.useRouter)(),{getEmail:n,clearAuthInfo:o}=(0,y.a)(),[S,T]=(0,R.useState)(null),b=(0,R.useRef)(!1),{data:L,loading:C,error:w,execute:P,userParams:M}=(0,I.h)(async e=>(await (0,j.bG)({email:e.email||n()||"",userId:e.userId,token:e.token})).data,null);return(0,R.useEffect)(()=>{M&&M.email&&M.userId&&M.token&&!b.current&&(b.current=!0,P())},[null==M?void 0:M.userId,null==M?void 0:M.token,null==M?void 0:M.email,P]),(0,R.useEffect)(()=>{L&&T(L)},[L]),(0,s.jsx)(E.a,{children:(0,s.jsxs)("main",{className:(0,_.AK)("flex",A.iK.LAYOUT.MIN_HEIGHT_DVH,A.iK.LAYOUT.FLEX_COL,"bg-white"),children:[(0,s.jsx)(m.h,{showLanguage:!0,logoLink:"/square"}),(0,s.jsxs)("div",{className:(0,_.AK)(A.iK.LAYOUT.FLEX_BETWEEN,A.vR.SPACING.PX_6,"py-4","text-[#11295b]"),children:[(0,s.jsx)("h1",{className:(0,_.AK)("text-xl",A.vR.COLORS.PRIMARY),children:e("personalCenter.title")}),(0,s.jsx)("button",{onClick:()=>t.push("/square"),className:(0,_.AK)(A.vR.COLORS.PRIMARY,"hover:text-[#11295b]"),children:(0,s.jsx)(l.Z,{className:A.vR.SIZES.ICON_LG})})]}),(0,s.jsxs)("div",{className:(0,_.AK)(A.vR.SPACING.PX_6,"py-4"),children:[C&&(0,s.jsxs)("div",{className:(0,_.AK)(A.iK.LAYOUT.FLEX_CENTER,"py-4"),children:[(0,s.jsx)(i.Z,{className:(0,_.AK)(A.vR.SIZES.ICON_MD,A.$w.SPIN,A.vR.COLORS.PRIMARY)}),(0,s.jsx)("span",{className:(0,_.AK)("ml-2",A.vR.COLORS.PRIMARY,A.vR.FONTS.NUNITO),children:e("userInfo.loading")})]}),w&&(0,s.jsxs)("div",{className:(0,_.AK)(A.iK.LAYOUT.FLEX_CENTER,"py-4"),children:[(0,s.jsx)(a.Z,{className:(0,_.AK)(A.vR.SIZES.ICON_MD,A.vR.COLORS.RED_500)}),(0,s.jsx)("span",{className:(0,_.AK)("ml-2",A.vR.COLORS.RED_500,A.vR.FONTS.NUNITO),children:e("userInfo.error")}),(0,s.jsx)("button",{onClick:()=>P(),className:(0,_.AK)("ml-2 p-1",A.vR.COLORS.PRIMARY,"hover:text-[#11295b]/80"),children:(0,s.jsx)(c.Z,{className:(0,_.AK)(A.vR.SIZES.ICON_SM)})})]}),!C&&!w&&(0,s.jsxs)("div",{className:(0,_.AK)("flex items-center",A.vR.SPACING.GAP_4),children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(v.default,{src:(0,O.nJ)(null==S?void 0:S.avatar),alt:"Profile",width:12,height:12,className:(0,_.AK)(A.vR.BORDER_RADIUS.ROUNDED_FULL,"h-12 w-12 object-cover")})}),(0,s.jsx)("div",{className:"flex-1 flex items-center text-[#11295b]",children:(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("h2",{className:(0,_.AK)("text-xl",A.vR.COLORS.PRIMARY,A.vR.FONTS.POPPINS,"flex items-center gap-1"),children:[(null==S?void 0:S.nickname)||(null==S?void 0:S.email)||"User",(0,s.jsx)(N.default,{href:"/personalization",children:(0,s.jsx)(r.z,{variant:"ghost",size:"icon",className:(0,_.AK)(A.vR.COLORS.PRIMARY,"p-1 h-7 w-7"),children:(0,s.jsx)(d,{className:"h-5 w-5"})})})]})})}),(0,s.jsxs)("div",{className:(0,_.AK)("flex items-center","text-[#11295b]",A.vR.SPACING.GAP_2),children:[(0,s.jsx)(N.default,{href:"/settings",children:(0,s.jsx)(r.z,{variant:"ghost",size:"icon",className:A.vR.COLORS.PRIMARY,children:(0,s.jsx)(u,{className:A.vR.SIZES.ICON_LG})})}),(0,s.jsx)(r.z,{variant:"ghost",size:"icon",className:A.vR.COLORS.PRIMARY,onClick:()=>{o(),t.push("/login")},title:e("personalCenter.logout"),children:(0,s.jsx)(f,{className:A.vR.SIZES.ICON_LG})})]})]})]}),(0,s.jsx)("div",{className:(0,_.AK)("flex-1",A.vR.SPACING.PX_6,"py-4"),children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(N.default,{href:"/personal",children:(0,s.jsx)(r.z,{variant:"ghost",className:(0,_.AK)("w-full justify-start","bg-[#11295b] text-white h-14 rounded-xl",A.vR.FONTS.NUNITO,"text-lg font-bold"),children:e("personalCenter.menu.myPage")})}),(0,s.jsx)("div",{className:"h-2"}),(0,s.jsx)(N.default,{href:"/followed",children:(0,s.jsx)(r.z,{variant:"ghost",className:(0,_.AK)("w-full justify-start","bg-[#11295b] text-white h-14 rounded-xl",A.vR.FONTS.NUNITO,"text-lg font-bold"),children:e("personalCenter.menu.followed")})}),(0,s.jsx)("div",{className:"h-2"}),(0,s.jsx)(N.default,{href:"/history",children:(0,s.jsx)(r.z,{variant:"ghost",className:(0,_.AK)("w-full justify-start","bg-[#11295b] text-white h-14 rounded-xl",A.vR.FONTS.NUNITO,"text-lg font-bold"),children:e("personalCenter.menu.history")})}),(0,s.jsx)("div",{className:"h-2"}),(0,s.jsx)(N.default,{href:"/favorite",children:(0,s.jsx)(r.z,{variant:"ghost",className:(0,_.AK)("w-full justify-start","bg-[#11295b] text-white h-14 rounded-xl",A.vR.FONTS.NUNITO,"text-lg font-bold"),children:e("personalCenter.menu.favorites")})})]})}),(0,s.jsx)("div",{className:(0,_.AK)(A.vR.SPACING.PX_6,"py-4"),children:(0,s.jsx)("div",{className:(0,_.AK)(A.iK.LAYOUT.FLEX_CENTER,A.vR.SPACING.GAP_4),children:(0,s.jsx)(N.default,{href:"/release",children:(0,s.jsxs)(r.z,{className:(0,_.AK)("bg-white rounded-full h-16 w-16 flex flex-col items-center justify-center gap-1 text-[#11295b]",A.vR.COLORS.PRIMARY,A.vR.FONTS.NUNITO,"text-lg font-bold"),size:"lg",children:[(0,s.jsx)(h.Z,{className:"h-48 w-48 ,'text-[#11295b]',"}),(0,s.jsx)("span",{className:(0,_.AK)("text-xs","text-[#11295b]",A.vR.FONT_WEIGHTS.SEMIBOLD),children:e("personalCenter.post.button")})]})})})}),(0,s.jsx)("div",{className:"mt-auto",children:(0,s.jsx)(g.$,{})})]})})}},2690:function(e,t,n){"use strict";n.d(t,{a:function(){return u}});var s=n(7437),r=n(2265),l=n(9376),i=n(6281),a=n(759),c=n(8783);let o=["/","/square","/login","/register","/forgot-password","/change-password","/personalization","/about","/privacy"];function d(e){return o.some(t=>"/"===t?"/"===e:e.startsWith(t))}function u(e){let{children:t,fallback:n}=e,{isAuthenticated:o,authInfo:u}=(0,i.a)(),{t:f}=(0,a.Z)(),h=(0,l.useRouter)(),x=(0,l.usePathname)(),[m,g]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{let e=setTimeout(()=>{g(!0)},100);return()=>clearTimeout(e)},[]),(0,r.useEffect)(()=>{if(!m){console.log("AuthGuard: Waiting for initialization...");return}if(console.log("AuthGuard useEffect triggered:",{pathname:x,search:window.location.search,isAuthenticated:o,hasAuthInfo:!!u,isPublic:d(x),isInitialized:m}),d(x)){console.log("Public path, no auth check needed");return}if(o&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token))console.log("User is authenticated, allowing access");else{let e;if(console.log("User not authenticated, checking for redirect loop"),function(e,t){if(console.log("Checking for redirect loop:",{pathname:e,search:t}),e.startsWith("/login"))return console.log("Current path is login page, preventing redirect"),!0;let n=new URLSearchParams(t).get("redirect");if(n){console.log("Found redirect parameter:",n);try{let e=decodeURIComponent(n);if(console.log("Decoded redirect:",e),e.includes("/login"))return console.log("Redirect contains /login, preventing loop"),!0;if(e.includes("redirect="))return console.log("Redirect contains nested redirect parameter, preventing loop"),!0;if(e.includes("?"))return console.log("Redirect contains query parameters, preventing loop"),!0;if(e.includes("%2Flogin")||e.includes("%252Flogin"))return console.log("Redirect contains encoded login path, preventing loop"),!0}catch(e){return console.warn("Failed to decode redirect parameter:",n,e),!0}}return console.log("No redirect loop detected"),!1}(x,window.location.search)){console.warn("Prevented redirect loop to login page");return}if("/login"===x){console.warn("Already on login page, preventing redirect");return}window.location.search.includes("redirect=")?(e="/login",console.log("Existing redirect detected, using default login URL")):console.log("Redirecting to login:",e="/login?redirect=".concat(encodeURIComponent(x))),h.push(e)}},[o,u,x,h,m]),d(x))?(0,s.jsx)(s.Fragment,{children:t}):o&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token)?(0,s.jsx)(s.Fragment,{children:t}):n||(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)(c.TK,{size:"lg",text:f("common.verifying")})})})}},8444:function(e,t,n){"use strict";n.d(t,{$:function(){return o}});var s=n(7437),r=n(759),l=n(2869),i=n(4508);function a(){let{language:e,setLanguage:t,t:n}=(0,r.Z)();return(0,s.jsxs)("div",{className:"flex items-center gap-2 mr-1",children:[(0,s.jsx)(l.z,{variant:"ghost",size:"sm",className:(0,i.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:n("footer.language.en")}),(0,s.jsx)(l.z,{variant:"ghost",size:"sm",className:(0,i.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:n("footer.language.zh")})]})}var c=n(7648);function o(){let{t:e}=(0,r.Z)();return(0,s.jsx)("footer",{className:"mt-auto text-[11px] text-muted-foreground py-2 px-2 w-full font-inter",children:(0,s.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,s.jsx)("div",{className:"flex items-center gap-2 font-inter",children:(0,s.jsx)(a,{})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,s.jsx)(c.default,{href:"/about",className:"text-muted-foreground font-inter",children:e("footer.links.about")}),(0,s.jsx)(c.default,{href:"/privacy",className:"text-muted-foreground font-inter",children:e("footer.links.privacy")}),(0,s.jsx)("span",{className:"text-muted-foreground font-inter",children:e("footer.copyright")})]})]})})}},8783:function(e,t,n){"use strict";n.d(t,{TK:function(){return c},Te:function(){return o},ub:function(){return d}});var s=n(7437),r=n(2869),l=n(9322),i=n(7168),a=n(759);function c(e){let{size:t="md",text:n,className:r=""}=e,{t:l}=(0,a.Z)(),i=n||l("common.loading");return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(r),children:[(0,s.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-[#11295b] ".concat({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t]," mb-2")}),i&&(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:i})]})}function o(e){let{error:t,onRetry:n,retryText:c,className:o=""}=e,{t:d}=(0,a.Z)(),u=c||d("common.retry");return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(o),children:[(0,s.jsx)(l.Z,{className:"h-8 w-8 text-red-500 mb-2"}),(0,s.jsx)("p",{className:"text-red-500 mb-4 text-center",children:t}),n&&(0,s.jsxs)(r.z,{onClick:n,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),u]})]})}function d(e){let{title:t,description:n,icon:r,action:l,className:i=""}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center ".concat(i),children:[r&&(0,s.jsx)("div",{className:"mb-4",children:r}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),n&&(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:n}),l&&(0,s.jsx)("div",{children:l})]})}},8685:function(e,t,n){"use strict";n.d(t,{$w:function(){return i},ZX:function(){return s},iK:function(){return l},vR:function(){return r}});let s={DEFAULT_PAGE:1,DEFAULT_LIMIT:999,MAX_LIMIT:100,REQUEST_TIMEOUT:1e4,MAX_RETRIES:3},r={COLORS:{PRIMARY:"#11295b",PRIMARY_OPACITY_80:"#11295b/80",PRIMARY_OPACITY_60:"#11295b/60",GRAY_100:"bg-gray-100",GRAY_400:"text-gray-400",RED_500:"text-red-500",WHITE:"text-white"},FONTS:{POPPINS:"font-poppins",NUNITO:"font-nunito",INTER:"font-inter"},FONT_WEIGHTS:{SEMIBOLD:"font-semibold",NORMAL:"font-normal"},SIZES:{ICON_SM:"h-3.5 w-3.5",ICON_MD:"h-6 w-6",ICON_LG:"h-7 w-7",ICON_XL:"h-8 w-8"},SPACING:{GAP_2:"gap-2",GAP_4:"gap-4",MB_2:"mb-2",MB_4:"mb-4",MB_6:"mb-6",MY_4:"my-4",PX_6:"px-6",PY_2:"py-2",PY_8:"py-8",PY_12:"py-12",PB_6:"pb-6"},BORDER_RADIUS:{ROUNDED_MD:"rounded-md",ROUNDED_FULL:"rounded-full"},EFFECTS:{OPACITY_50:"opacity-50",OPACITY_80:"/80",OPACITY_60:"/60"}},l={IMAGES:{MAX_THUMBNAILS:3,DEFAULT_IMAGE:"/img/band.png",THUMBNAIL_SIZE:{width:360,height:220},THUMBNAIL_CLASS:"w-full h-28 object-cover rounded-md"},LAYOUT:{GRID_COLS_3:"grid-cols-3",MIN_HEIGHT_DVH:"min-h-dvh",FLEX_COL:"flex-col",FLEX_CENTER:"flex items-center justify-center",FLEX_BETWEEN:"flex items-center justify-between"},TEXT_SIZES:{TITLE:"text-2xl",SUBTITLE:"text-lg",BODY:"text-[15px]",SMALL:"text-sm",XS:"text-xs"}},i={SPIN:"animate-spin",FADE_IN:"animate-fade-in",SLIDE_UP:"animate-slide-up"}},7471:function(e,t,n){"use strict";n.d(t,{h:function(){return i}});var s=n(2265),r=n(9376),l=n(6281);function i(e,t){let[n,i]=(0,s.useState)({data:null,loading:!1,error:null,success:!1}),a=(0,r.useSearchParams)(),{userParams:c}=(0,l.z)(),o=(0,s.useCallback)(()=>{if(c)return c;let e=a.get("userId"),t=a.get("token"),n=a.get("email");return e&&t?{userId:e,token:t,email:n||void 0}:null},[a,c]),d=(0,s.useCallback)(async n=>{let s=n||o();if(!s){t&&i({data:t,loading:!1,error:null,success:!0});return}i(e=>({...e,loading:!0,error:null}));try{let t=await e(s);i({data:t,loading:!1,error:null,success:!0})}catch(e){i({data:t||null,loading:!1,error:e instanceof Error?e.message:"请求失败",success:!1})}},[e,o,t]),u=(0,s.useCallback)(()=>{i({data:null,loading:!1,error:null,success:!1})},[]);return{...n,execute:d,reset:u,userParams:o()}}},1190:function(e,t,n){"use strict";n.d(t,{tL:function(){return l},bG:function(){return i.bG}});var s=n(8806),r=n(8685);async function l(e){return(0,s.WY)("getmypagelist",{userId:e.userId,token:e.token,page:e.page||r.ZX.DEFAULT_PAGE,limit:e.limit||r.ZX.DEFAULT_LIMIT})}var i=n(6023)},6652:function(e,t,n){"use strict";n.d(t,{AK:function(){return r}});var s=n(4508);function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.cn)(...t.filter(Boolean))}},2451:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(9205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9322:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6937:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(9205).Z)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},1817:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(9205).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},7168:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},function(e){e.O(0,[516,51,282,971,117,744],function(){return e(e.s=2990)}),_N_E=e.O()}]);