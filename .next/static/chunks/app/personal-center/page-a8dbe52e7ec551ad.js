(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[267],{2990:function(e,t,n){Promise.resolve().then(n.bind(n,2477))},2477:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var r=n(7437),s=n(2869),i=n(2451),l=n(1817),a=n(9322),o=n(7168);let c=(0,n(9205).Z)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);var d=n(759),u=n(4196),h=n(1839),f=n(7648),m=n(3145),x=n(9376),g=n(2265),p=n(7471),N=n(1190),v=n(8685),j=n(9116),A=n(6652),w=n(6281),R=n(2690);function I(){let{t:e}=(0,d.Z)(),t=(0,x.useRouter)(),{getEmail:n,clearAuthInfo:I}=(0,w.a)(),[E,_]=(0,g.useState)(null),b=(0,g.useRef)(!1),{data:y,loading:C,error:L,execute:O,userParams:T}=(0,p.h)(async e=>(await (0,N.bG)({email:e.email||n()||"",userId:e.userId,token:e.token})).data,null);return(0,g.useEffect)(()=>{T&&T.email&&T.userId&&T.token&&!b.current&&(b.current=!0,O())},[null==T?void 0:T.userId,null==T?void 0:T.token,null==T?void 0:T.email,O]),(0,g.useEffect)(()=>{y&&_(y)},[y]),(0,r.jsx)(R.a,{children:(0,r.jsxs)("main",{className:(0,A.AK)("flex",v.iK.LAYOUT.MIN_HEIGHT_DVH,v.iK.LAYOUT.FLEX_COL,"bg-white","font-semibold","text-xl","text-[#0F1728]"),children:[(0,r.jsx)(u.h,{logoLink:"/square"}),(0,r.jsxs)("div",{className:(0,A.AK)(v.iK.LAYOUT.FLEX_BETWEEN,"px-4 py-4 z-100","text-[#0F1728]"),children:[(0,r.jsx)("h1",{className:"text-xl font-poppins text-[#0F1728] font-semibold",children:e("personalCenter.title")}),(0,r.jsx)("button",{onClick:()=>t.push("/square"),className:"text-[#0F1728] hover:text-[#0F1728]",children:(0,r.jsx)(i.Z,{className:"h-8 w-8 z-100"})})]}),(0,r.jsxs)("div",{className:(0,A.AK)("px-4"),children:[C&&(0,r.jsxs)("div",{className:(0,A.AK)(v.iK.LAYOUT.FLEX_CENTER,"py-4"),children:[(0,r.jsx)(l.Z,{className:(0,A.AK)(v.vR.SIZES.ICON_MD,v.$w.SPIN,v.vR.COLORS.PRIMARY)}),(0,r.jsx)("span",{className:(0,A.AK)("ml-2",v.vR.COLORS.PRIMARY,v.vR.FONTS.NUNITO),children:e("userInfo.loading")})]}),L&&(0,r.jsxs)("div",{className:(0,A.AK)(v.iK.LAYOUT.FLEX_CENTER,"py-4"),children:[(0,r.jsx)(a.Z,{className:(0,A.AK)(v.vR.SIZES.ICON_MD,v.vR.COLORS.RED_500)}),(0,r.jsx)("span",{className:(0,A.AK)("ml-2",v.vR.COLORS.RED_500,v.vR.FONTS.NUNITO),children:e("userInfo.error")}),(0,r.jsx)("button",{onClick:()=>O(),className:(0,A.AK)("ml-2 p-1",v.vR.COLORS.PRIMARY,"hover:text-[#11295b]/80"),children:(0,r.jsx)(o.Z,{className:(0,A.AK)(v.vR.SIZES.ICON_SM)})})]}),!C&&!L&&(0,r.jsxs)("div",{className:(0,A.AK)("flex items-center",v.vR.SPACING.GAP_4),children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)(m.default,{src:(0,j.nJ)(null==E?void 0:E.avatar),alt:"Profile",width:12,height:12,className:(0,A.AK)(v.vR.BORDER_RADIUS.ROUNDED_FULL,"h-9 w-9 object-cover")})}),(0,r.jsx)("div",{className:"flex-1 flex items-center text-[#11295b]",children:(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("h2",{className:"text-sm text-[#0F1728] flex items-center gap-1 font-inter",children:[(null==E?void 0:E.nickname)||(null==E?void 0:E.email)||"User",(0,r.jsx)(f.default,{href:"/personalization",children:(0,r.jsx)(s.z,{variant:"ghost",size:"icon",children:(0,r.jsx)(m.default,{src:"/img/RotateCcw.png",alt:"rotate",width:16,height:16,className:"h-4 w-auto z-10"})})})]})})}),(0,r.jsxs)("div",{className:(0,A.AK)("flex items-center","text-[#11295b]",v.vR.SPACING.GAP_2),children:[(0,r.jsx)(f.default,{href:"/settings",children:(0,r.jsx)(s.z,{variant:"ghost",size:"icon",className:v.vR.COLORS.PRIMARY,children:(0,r.jsx)(m.default,{src:"/img/set.png",alt:"settings",width:16,height:16,className:"h-8 w-8"})})}),(0,r.jsx)(s.z,{variant:"ghost",size:"icon",className:v.vR.COLORS.PRIMARY,onClick:()=>{I(),t.push("/login")},title:e("personalCenter.logout"),children:(0,r.jsx)(c,{className:"h-8 w-8"})})]})]})]}),(0,r.jsx)("div",{className:(0,A.AK)("flex-1 px-4 py-4"),children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(f.default,{href:"/personal",children:(0,r.jsx)(s.z,{variant:"ghost",className:(0,A.AK)("w-full justify-start","bg-[#11295b] text-white h-13 rounded-lg","font-poppins","text-[17px] font-semibold"),children:e("personalCenter.menu.myPage")})}),(0,r.jsx)("div",{className:"h-2"}),(0,r.jsx)(f.default,{href:"/followed",children:(0,r.jsx)(s.z,{variant:"ghost",className:(0,A.AK)("w-full justify-start","bg-[#11295b] text-white h-13 rounded-lg","font-poppins","text-[17px] font-semibold"),children:e("personalCenter.menu.followed")})}),(0,r.jsx)("div",{className:"h-2"}),(0,r.jsx)(f.default,{href:"/history",children:(0,r.jsx)(s.z,{variant:"ghost",className:(0,A.AK)("w-full justify-start","bg-[#11295b] text-white h-13 rounded-lg","font-poppins","text-[17px] font-semibold"),children:e("personalCenter.menu.history")})}),(0,r.jsx)("div",{className:"h-2"}),(0,r.jsx)(f.default,{href:"/favorite",children:(0,r.jsx)(s.z,{variant:"ghost",className:(0,A.AK)("w-full justify-start","bg-[#11295b] text-white h-13 rounded-lg","font-poppins","text-[17px] font-semibold"),children:e("personalCenter.menu.favorites")})})]})}),(0,r.jsx)("div",{className:(0,A.AK)(v.vR.SPACING.PX_6,"py-4"),children:(0,r.jsx)("div",{className:(0,A.AK)(v.iK.LAYOUT.FLEX_CENTER,v.vR.SPACING.GAP_4),children:(0,r.jsx)(f.default,{href:"/release",children:(0,r.jsxs)(s.z,{className:(0,A.AK)("bg-white rounded-full  flex flex-col items-center justify-center gap-1 text-[#11295b]",v.vR.COLORS.PRIMARY,v.vR.FONTS.NUNITO,"text-[17px] font-semibold"),size:"lg",children:[(0,r.jsx)(m.default,{src:"/img/post.png",alt:"post",width:16,height:16,className:"h-14 w-14"}),(0,r.jsx)("span",{className:(0,A.AK)("text-sm","text-[#0F1728]","font-semibold font-poppins"),children:e("personalCenter.post.button")})]})})})}),(0,r.jsx)("div",{className:"mt-auto",children:(0,r.jsx)(h.$,{})})]})})}},2690:function(e,t,n){"use strict";n.d(t,{a:function(){return u}});var r=n(7437),s=n(2265),i=n(9376),l=n(6281),a=n(759),o=n(8783);let c=["/","/square","/login","/register","/forgot-password","/change-password","/personalization","/about","/privacy"];function d(e){return c.some(t=>"/"===t?"/"===e:e.startsWith(t))}function u(e){let{children:t,fallback:n}=e,{isAuthenticated:c,authInfo:u}=(0,l.a)(),{t:h}=(0,a.Z)(),f=(0,i.useRouter)(),m=(0,i.usePathname)(),[x,g]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{let e=setTimeout(()=>{g(!0)},100);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{if(!x){console.log("AuthGuard: Waiting for initialization...");return}if(console.log("AuthGuard useEffect triggered:",{pathname:m,search:window.location.search,isAuthenticated:c,hasAuthInfo:!!u,isPublic:d(m),isInitialized:x}),d(m)){console.log("Public path, no auth check needed");return}if(c&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token))console.log("User is authenticated, allowing access");else{let e;if(console.log("User not authenticated, checking for redirect loop"),function(e,t){if(console.log("Checking for redirect loop:",{pathname:e,search:t}),e.startsWith("/login"))return console.log("Current path is login page, preventing redirect"),!0;let n=new URLSearchParams(t).get("redirect");if(n){console.log("Found redirect parameter:",n);try{let e=decodeURIComponent(n);if(console.log("Decoded redirect:",e),e.includes("/login"))return console.log("Redirect contains /login, preventing loop"),!0;if(e.includes("redirect="))return console.log("Redirect contains nested redirect parameter, preventing loop"),!0;if(e.includes("?"))return console.log("Redirect contains query parameters, preventing loop"),!0;if(e.includes("%2Flogin")||e.includes("%252Flogin"))return console.log("Redirect contains encoded login path, preventing loop"),!0}catch(e){return console.warn("Failed to decode redirect parameter:",n,e),!0}}return console.log("No redirect loop detected"),!1}(m,window.location.search)){console.warn("Prevented redirect loop to login page");return}if("/login"===m){console.warn("Already on login page, preventing redirect");return}window.location.search.includes("redirect=")?(e="/login",console.log("Existing redirect detected, using default login URL")):console.log("Redirecting to login:",e="/login?redirect=".concat(encodeURIComponent(m))),f.push(e)}},[c,u,m,f,x]),d(m))?(0,r.jsx)(r.Fragment,{children:t}):c&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token)?(0,r.jsx)(r.Fragment,{children:t}):n||(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)(o.TK,{size:"lg",text:h("common.verifying")})})})}},1839:function(e,t,n){"use strict";n.d(t,{$:function(){return o}});var r=n(7437),s=n(759),i=n(3145);function l(e){let{transparent:t=!1}=e,{language:n,setLanguage:l}=(0,s.Z)();return(0,r.jsxs)("button",{onClick:()=>{l("en"===n?"zh":"en")},className:"flex items-center ".concat(t?"text-white":"text-[#0F1728]"," hover:opacity-80 transition-opacity"),"aria-label":"Switch to ".concat("en"===n?"Chinese":"English"),children:[(0,r.jsx)(i.default,{src:t?"/img/lang.png":"/img/lang-d.png",alt:"Language",width:24,height:24,className:"h-4 w-4"}),(0,r.jsx)("span",{className:"text-[10px] font-medium ml-1 ".concat(t?"text-white":"text-[#0F1728]"),children:"en"===n?"EN":"CN"})]})}var a=n(7648);function o(e){let{transparent:t=!1}=e,{t:n}=(0,s.Z)();return(0,r.jsx)("footer",{className:"mt-auto text-[10px] py-4 px-4 w-full font-inter ".concat(t?"text-white":"text-[#0F1728]"),children:(0,r.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 font-inter",children:(0,r.jsx)(l,{transparent:t})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,r.jsx)(a.default,{href:"/about",className:"".concat(t?"text-white":"text-[#0F1728]"," font-inter"),children:n("footer.links.about")}),(0,r.jsx)(a.default,{href:"/privacy",className:"".concat(t?"text-white":"text-[#0F1728]"," font-inter"),children:n("footer.links.privacy")}),(0,r.jsx)("span",{className:"".concat(t?"text-white":"text-[#0F1728]"," font-inter"),children:n("footer.copyright")}),(0,r.jsx)(i.default,{src:t?"/img/logo-1.png":"/img/logo-2.png",alt:"Language",width:52,height:22,className:"h-5 w-auto"})]})]})})}},8783:function(e,t,n){"use strict";n.d(t,{TK:function(){return o},Te:function(){return c},ub:function(){return d}});var r=n(7437),s=n(2869),i=n(9322),l=n(7168),a=n(759);function o(e){let{size:t="md",text:n,className:s=""}=e,{t:i}=(0,a.Z)(),l=n||i("common.loading");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(s),children:[(0,r.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-[#11295b] ".concat({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t]," mb-2")}),l&&(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:l})]})}function c(e){let{error:t,onRetry:n,retryText:o,className:c=""}=e,{t:d}=(0,a.Z)(),u=o||d("common.retry");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(c),children:[(0,r.jsx)(i.Z,{className:"h-8 w-8 text-red-500 mb-2"}),(0,r.jsx)("p",{className:"text-red-500 mb-4 text-center",children:t}),n&&(0,r.jsxs)(s.z,{onClick:n,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),u]})]})}function d(e){let{title:t,description:n,icon:s,action:i,className:l=""}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center text-center ".concat(l),children:[s&&(0,r.jsx)("div",{className:"mb-4",children:s}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),n&&(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:n}),i&&(0,r.jsx)("div",{children:i})]})}},8685:function(e,t,n){"use strict";n.d(t,{$w:function(){return l},ZX:function(){return r},iK:function(){return i},vR:function(){return s}});let r={DEFAULT_PAGE:1,DEFAULT_LIMIT:999,MAX_LIMIT:100,REQUEST_TIMEOUT:1e4,MAX_RETRIES:3},s={COLORS:{PRIMARY:"#11295b",PRIMARY_OPACITY_80:"#11295b/80",PRIMARY_OPACITY_60:"#11295b/60",GRAY_100:"bg-gray-100",GRAY_400:"text-gray-400",RED_500:"text-red-500",WHITE:"text-white"},FONTS:{POPPINS:"font-poppins",NUNITO:"font-nunito",INTER:"font-inter"},FONT_WEIGHTS:{SEMIBOLD:"font-semibold",NORMAL:"font-normal"},SIZES:{ICON_SM:"h-3.5 w-3.5",ICON_MD:"h-6 w-6",ICON_LG:"h-7 w-7",ICON_XL:"h-8 w-8"},SPACING:{GAP_2:"gap-2",GAP_4:"gap-4",MB_2:"mb-2",MB_4:"mb-4",MB_6:"mb-6",MY_4:"my-4",PX_6:"px-6",PY_2:"py-2",PY_8:"py-8",PY_12:"py-12",PB_6:"pb-6"},BORDER_RADIUS:{ROUNDED_MD:"rounded-md",ROUNDED_FULL:"rounded-full"},EFFECTS:{OPACITY_50:"opacity-50",OPACITY_80:"/80",OPACITY_60:"/60"}},i={IMAGES:{MAX_THUMBNAILS:3,DEFAULT_IMAGE:"/img/band.png",THUMBNAIL_SIZE:{width:360,height:220},THUMBNAIL_CLASS:"w-full h-28 object-cover rounded-md"},LAYOUT:{GRID_COLS_3:"grid-cols-3",MIN_HEIGHT_DVH:"min-h-dvh",FLEX_COL:"flex-col",FLEX_CENTER:"flex items-center justify-center",FLEX_BETWEEN:"flex items-center justify-between"},TEXT_SIZES:{TITLE:"text-2xl",SUBTITLE:"text-lg",BODY:"text-[15px]",SMALL:"text-sm",XS:"text-xs"}},l={SPIN:"animate-spin",FADE_IN:"animate-fade-in",SLIDE_UP:"animate-slide-up"}},7471:function(e,t,n){"use strict";n.d(t,{h:function(){return l}});var r=n(2265),s=n(9376),i=n(6281);function l(e,t){let[n,l]=(0,r.useState)({data:null,loading:!1,error:null,success:!1}),a=(0,s.useSearchParams)(),{userParams:o}=(0,i.z)(),c=(0,r.useCallback)(()=>{if(o)return o;let e=a.get("userId"),t=a.get("token"),n=a.get("email");return e&&t?{userId:e,token:t,email:n||void 0}:null},[a,o]),d=(0,r.useCallback)(async n=>{let r=n||c();if(!r){t&&l({data:t,loading:!1,error:null,success:!0});return}l(e=>({...e,loading:!0,error:null}));try{let t=await e(r);l({data:t,loading:!1,error:null,success:!0})}catch(e){l({data:t||null,loading:!1,error:e instanceof Error?e.message:"请求失败",success:!1})}},[e,c,t]),u=(0,r.useCallback)(()=>{l({data:null,loading:!1,error:null,success:!1})},[]);return{...n,execute:d,reset:u,userParams:c()}}},1190:function(e,t,n){"use strict";n.d(t,{tL:function(){return i},bG:function(){return l.bG}});var r=n(8806),s=n(8685);async function i(e){return(0,r.WY)("getmypagelist",{userId:e.userId,token:e.token,page:e.page||s.ZX.DEFAULT_PAGE,limit:e.limit||s.ZX.DEFAULT_LIMIT})}var l=n(6023)},6652:function(e,t,n){"use strict";n.d(t,{AK:function(){return s}});var r=n(4508);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r.cn)(...t.filter(Boolean))}},9205:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(2265);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),l=e=>{let t=i(e);return t.charAt(0).toUpperCase()+t.slice(1)},a=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()},o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,r.forwardRef)((e,t)=>{let{color:n="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:d="",children:u,iconNode:h,...f}=e;return(0,r.createElement)("svg",{ref:t,...c,width:s,height:s,stroke:n,strokeWidth:l?24*Number(i)/Number(s):i,className:a("lucide",d),...!u&&!o(f)&&{"aria-hidden":"true"},...f},[...h.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(u)?u:[u]])}),u=(e,t)=>{let n=(0,r.forwardRef)((n,i)=>{let{className:o,...c}=n;return(0,r.createElement)(d,{ref:i,iconNode:t,className:a("lucide-".concat(s(l(e))),"lucide-".concat(e),o),...c})});return n.displayName=l(e),n}},2451:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9322:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},1817:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},7168:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},function(e){e.O(0,[604,51,624,971,117,744],function(){return e(e.s=2990)}),_N_E=e.O()}]);