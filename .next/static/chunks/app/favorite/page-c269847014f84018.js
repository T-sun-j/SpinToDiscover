(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[705],{4024:function(e,t,n){Promise.resolve().then(n.bind(n,9359))},9359:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var r=n(7437),s=n(9512),i=n(8444),a=n(759),l=n(2690),c=n(3276),o=n(8997),d=n(2451),u=n(1817),f=n(9322),m=n(3145),x=n(9376),h=n(2265),g=n(7471),p=n(6023),v=n(9116),j=n(8685);function N(){let{t:e}=(0,a.Z)(),t=(0,x.useRouter)(),[n,N]=(0,h.useState)([]),y=(0,h.useRef)(!1),{data:b,loading:w,error:I,execute:_,userParams:A}=(0,g.h)(async e=>await (0,p.B$)({userId:e.userId,token:e.token,page:j.ZX.DEFAULT_PAGE,limit:j.ZX.DEFAULT_LIMIT}),null);(0,h.useEffect)(()=>{A&&A.userId&&A.token&&!y.current&&(y.current=!0,_())},[null==A?void 0:A.userId,null==A?void 0:A.token,_]);let E=e=>e&&Array.isArray(e)&&0!==e.length?e.map(e=>{var t,n,r;let s=(null===(t=e._id)||void 0===t?void 0:t.$oid)||e.proid||"",i=(null===(n=e.product)||void 0===n?void 0:n[0])||{},a=i.title||"",l=i.description||"",c=i.piclist||[],o=i.video||"",d=i.location||"",u=e.uid||"",f=(null===(r=e.users)||void 0===r?void 0:r[0])||{userId:u,nickname:"",avatar:""};return{id:s,title:a,description:l,images:c,video:o,location:d,collectedAt:e.createtime?new Date(1e3*e.createtime).toISOString():new Date().toISOString(),author:{userId:f.userId||u,nickname:f.nickname||"",avatar:f.avatar||""}}}):[];(0,h.useEffect)(()=>{b?b.success&&b.data?Array.isArray(b.data)?N(E(b.data)):b.data.dataList&&Array.isArray(b.data.dataList)?N(b.data.dataList):N(E([b.data])):Array.isArray(b)?N(E(b)):b.dataList&&Array.isArray(b.dataList)?N(b.dataList):N(E([b])):N([])},[b]);let L=t=>{let{item:n}=t;return(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:n.images.slice(0,3).map((t,s)=>(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(m.default,{src:(0,v.nJ)(t)||"/img/default-image.png",alt:"".concat(e("favoritePage.favoriteItem")," ").concat(s+1),width:112,height:112,className:"w-full h-28 object-cover rounded-md",priority:0===s}),0===s&&n.video&&(0,r.jsx)("div",{className:"absolute bottom-2 right-2 w-6 h-6 rounded-full bg-[#11295b]/80 flex items-center justify-center",children:(0,r.jsx)(c.Z,{className:"w-3 h-3 text-white"})})]},s))}),(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsx)("h3",{className:"text-[18px] text-[#11295b] font-poppins flex-1",children:n.title}),(0,r.jsx)("button",{"aria-label":e("favoritePage.removeFromFavorites"),className:"ml-2 p-1 text-red-500 hover:text-red-600 transition-colors",children:(0,r.jsx)(o.Z,{className:"h-5 w-5 fill-current"})})]}),(0,r.jsx)("p",{className:"text-sm leading-6 text-[#11295b]/80 font-nunito mb-2",children:n.description}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-[#11295b]/60",children:[(0,r.jsx)("span",{className:"font-nunito",children:n.author.nickname}),(0,r.jsxs)("span",{className:"font-nunito",children:[e("favoritePage.collectedOn")," ",new Date(n.collectedAt).toLocaleDateString()]})]})]})};return(0,r.jsx)(l.a,{children:(0,r.jsxs)("main",{className:"flex min-h-dvh flex-col bg-white",children:[(0,r.jsx)(s.h,{showLanguage:!0,showSearch:!0,showUser:!0}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-2",children:[(0,r.jsx)("h1",{className:"text-2xl text-[#11295b] font-poppins",children:e("favoritePage.title")}),(0,r.jsx)("button",{"aria-label":e("favoritePage.back"),onClick:()=>t.back(),className:"text-[#11295b] hover:text-[#11295b]",children:(0,r.jsx)(d.Z,{className:"h-7 w-7"})})]}),(0,r.jsxs)("section",{className:"px-6 pb-6 flex-1",children:[w&&(0,r.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,r.jsx)(u.Z,{className:"w-5 h-5 animate-spin text-[#11295b]"}),(0,r.jsx)("span",{className:"ml-2 text-[#11295b] font-nunito",children:e("favoritePage.loading")})]}),I&&n.length>0&&(0,r.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,r.jsx)(f.Z,{className:"w-5 h-5 text-red-500"}),(0,r.jsx)("span",{className:"ml-2 text-red-500 font-nunito",children:e("favoritePage.error")})]}),!w&&0===n.length&&(0,r.jsx)(()=>(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[(0,r.jsx)(o.Z,{className:"h-16 w-16 text-gray-300 mb-4"}),(0,r.jsx)("h3",{className:"text-lg  text-[#11295b] font-poppins mb-2",children:e("favoritePage.emptyTitle")}),(0,r.jsx)("p",{className:"text-[15px] text-[#11295b]/60 font-nunito max-w-sm",children:e("favoritePage.emptyDescription")})]}),{}),!w&&!I&&n.length>0&&(0,r.jsx)(r.Fragment,{children:n.map((e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsx)(L,{item:e}),t<n.length-1&&(0,r.jsx)("div",{className:"border-t border-gray-200 my-4"})]},e.id))})]}),(0,r.jsx)(i.$,{})]})})}},2690:function(e,t,n){"use strict";n.d(t,{a:function(){return u}});var r=n(7437),s=n(2265),i=n(9376),a=n(6281),l=n(759),c=n(8783);let o=["/","/square","/login","/register","/forgot-password","/change-password","/personalization","/about","/privacy"];function d(e){return o.some(t=>"/"===t?"/"===e:e.startsWith(t))}function u(e){let{children:t,fallback:n}=e,{isAuthenticated:o,authInfo:u}=(0,a.a)(),{t:f}=(0,l.Z)(),m=(0,i.useRouter)(),x=(0,i.usePathname)(),[h,g]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{let e=setTimeout(()=>{g(!0)},100);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{if(!h){console.log("AuthGuard: Waiting for initialization...");return}if(console.log("AuthGuard useEffect triggered:",{pathname:x,search:window.location.search,isAuthenticated:o,hasAuthInfo:!!u,isPublic:d(x),isInitialized:h}),d(x)){console.log("Public path, no auth check needed");return}if(o&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token))console.log("User is authenticated, allowing access");else{let e;if(console.log("User not authenticated, checking for redirect loop"),function(e,t){if(console.log("Checking for redirect loop:",{pathname:e,search:t}),e.startsWith("/login"))return console.log("Current path is login page, preventing redirect"),!0;let n=new URLSearchParams(t).get("redirect");if(n){console.log("Found redirect parameter:",n);try{let e=decodeURIComponent(n);if(console.log("Decoded redirect:",e),e.includes("/login"))return console.log("Redirect contains /login, preventing loop"),!0;if(e.includes("redirect="))return console.log("Redirect contains nested redirect parameter, preventing loop"),!0;if(e.includes("?"))return console.log("Redirect contains query parameters, preventing loop"),!0;if(e.includes("%2Flogin")||e.includes("%252Flogin"))return console.log("Redirect contains encoded login path, preventing loop"),!0}catch(e){return console.warn("Failed to decode redirect parameter:",n,e),!0}}return console.log("No redirect loop detected"),!1}(x,window.location.search)){console.warn("Prevented redirect loop to login page");return}if("/login"===x){console.warn("Already on login page, preventing redirect");return}window.location.search.includes("redirect=")?(e="/login",console.log("Existing redirect detected, using default login URL")):console.log("Redirecting to login:",e="/login?redirect=".concat(encodeURIComponent(x))),m.push(e)}},[o,u,x,m,h]),d(x))?(0,r.jsx)(r.Fragment,{children:t}):o&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token)?(0,r.jsx)(r.Fragment,{children:t}):n||(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)(c.TK,{size:"lg",text:f("common.verifying")})})})}},8444:function(e,t,n){"use strict";n.d(t,{$:function(){return o}});var r=n(7437),s=n(759),i=n(2869),a=n(4508);function l(){let{language:e,setLanguage:t,t:n}=(0,s.Z)();return(0,r.jsxs)("div",{className:"flex items-center gap-2 mr-1",children:[(0,r.jsx)(i.z,{variant:"ghost",size:"sm",className:(0,a.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:n("footer.language.en")}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",className:(0,a.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:n("footer.language.zh")})]})}var c=n(7648);function o(){let{t:e}=(0,s.Z)();return(0,r.jsx)("footer",{className:"mt-auto text-[11px] text-muted-foreground py-2 px-2 w-full font-inter",children:(0,r.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 font-inter",children:(0,r.jsx)(l,{})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,r.jsx)(c.default,{href:"/about",className:"text-muted-foreground font-inter",children:e("footer.links.about")}),(0,r.jsx)(c.default,{href:"/privacy",className:"text-muted-foreground font-inter",children:e("footer.links.privacy")}),(0,r.jsx)("span",{className:"text-muted-foreground font-inter",children:e("footer.copyright")})]})]})})}},8783:function(e,t,n){"use strict";n.d(t,{TK:function(){return c},Te:function(){return o},ub:function(){return d}});var r=n(7437),s=n(2869),i=n(9322),a=n(7168),l=n(759);function c(e){let{size:t="md",text:n,className:s=""}=e,{t:i}=(0,l.Z)(),a=n||i("common.loading");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(s),children:[(0,r.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-[#11295b] ".concat({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t]," mb-2")}),a&&(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:a})]})}function o(e){let{error:t,onRetry:n,retryText:c,className:o=""}=e,{t:d}=(0,l.Z)(),u=c||d("common.retry");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(o),children:[(0,r.jsx)(i.Z,{className:"h-8 w-8 text-red-500 mb-2"}),(0,r.jsx)("p",{className:"text-red-500 mb-4 text-center",children:t}),n&&(0,r.jsxs)(s.z,{onClick:n,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,r.jsx)(a.Z,{className:"h-4 w-4"}),u]})]})}function d(e){let{title:t,description:n,icon:s,action:i,className:a=""}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center text-center ".concat(a),children:[s&&(0,r.jsx)("div",{className:"mb-4",children:s}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),n&&(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:n}),i&&(0,r.jsx)("div",{children:i})]})}},8685:function(e,t,n){"use strict";n.d(t,{$w:function(){return a},ZX:function(){return r},iK:function(){return i},vR:function(){return s}});let r={DEFAULT_PAGE:1,DEFAULT_LIMIT:999,MAX_LIMIT:100,REQUEST_TIMEOUT:1e4,MAX_RETRIES:3},s={COLORS:{PRIMARY:"#11295b",PRIMARY_OPACITY_80:"#11295b/80",PRIMARY_OPACITY_60:"#11295b/60",GRAY_100:"bg-gray-100",GRAY_400:"text-gray-400",RED_500:"text-red-500",WHITE:"text-white"},FONTS:{POPPINS:"font-poppins",NUNITO:"font-nunito",INTER:"font-inter"},FONT_WEIGHTS:{SEMIBOLD:"font-semibold",NORMAL:"font-normal"},SIZES:{ICON_SM:"h-3.5 w-3.5",ICON_MD:"h-6 w-6",ICON_LG:"h-7 w-7",ICON_XL:"h-8 w-8"},SPACING:{GAP_2:"gap-2",GAP_4:"gap-4",MB_2:"mb-2",MB_4:"mb-4",MB_6:"mb-6",MY_4:"my-4",PX_6:"px-6",PY_2:"py-2",PY_8:"py-8",PY_12:"py-12",PB_6:"pb-6"},BORDER_RADIUS:{ROUNDED_MD:"rounded-md",ROUNDED_FULL:"rounded-full"},EFFECTS:{OPACITY_50:"opacity-50",OPACITY_80:"/80",OPACITY_60:"/60"}},i={IMAGES:{MAX_THUMBNAILS:3,DEFAULT_IMAGE:"/img/band.png",THUMBNAIL_SIZE:{width:360,height:220},THUMBNAIL_CLASS:"w-full h-28 object-cover rounded-md"},LAYOUT:{GRID_COLS_3:"grid-cols-3",MIN_HEIGHT_DVH:"min-h-dvh",FLEX_COL:"flex-col",FLEX_CENTER:"flex items-center justify-center",FLEX_BETWEEN:"flex items-center justify-between"},TEXT_SIZES:{TITLE:"text-2xl",SUBTITLE:"text-lg",BODY:"text-[15px]",SMALL:"text-sm",XS:"text-xs"}},a={SPIN:"animate-spin",FADE_IN:"animate-fade-in",SLIDE_UP:"animate-slide-up"}},7471:function(e,t,n){"use strict";n.d(t,{h:function(){return a}});var r=n(2265),s=n(9376),i=n(6281);function a(e,t){let[n,a]=(0,r.useState)({data:null,loading:!1,error:null,success:!1}),l=(0,s.useSearchParams)(),{userParams:c}=(0,i.z)(),o=(0,r.useCallback)(()=>{if(c)return c;let e=l.get("userId"),t=l.get("token"),n=l.get("email");return e&&t?{userId:e,token:t,email:n||void 0}:null},[l,c]),d=(0,r.useCallback)(async n=>{let r=n||o();if(!r){t&&a({data:t,loading:!1,error:null,success:!0});return}a(e=>({...e,loading:!0,error:null}));try{let t=await e(r);a({data:t,loading:!1,error:null,success:!0})}catch(e){a({data:t||null,loading:!1,error:e instanceof Error?e.message:"请求失败",success:!1})}},[e,o,t]),u=(0,r.useCallback)(()=>{a({data:null,loading:!1,error:null,success:!1})},[]);return{...n,execute:d,reset:u,userParams:o()}}},2451:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9322:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},8997:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]])},1817:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3276:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]])},7168:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},function(e){e.O(0,[516,51,282,971,117,744],function(){return e(e.s=4024)}),_N_E=e.O()}]);