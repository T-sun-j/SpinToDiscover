(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[664],{9357:function(e,t,n){Promise.resolve().then(n.bind(n,27))},27:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var a=n(7437),s=n(2869),i=n(9205);let r=(0,i.Z)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);var o=n(3774),l=n(2489);let c=(0,i.Z)("file-x",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m14.5 12.5-5 5",key:"b62r18"}],["path",{d:"m9.5 12.5 5 5",key:"1rk7el"}]]);var d=n(1178),u=n(8997),x=n(8919),m=n(759),h=n(6281),f=n(9512),g=n(8444),p=n(2265),y=n(9376),v=n(6023),j=n(9116),k=n(8783),b=n(5120),N=n(4512);function w(){let{t:e}=(0,m.Z)(),{authInfo:t,isAuthenticated:n}=(0,h.a)(),i=(0,y.useRouter)(),w=(0,y.useSearchParams)(),[I,q]=(0,p.useState)("recommend"),[C,Z]=(0,p.useState)([]),[L,S]=(0,p.useState)(!1),[z,E]=(0,p.useState)(""),[_,A]=(0,p.useState)(""),[M,T]=(0,p.useState)(""),[P,F]=(0,p.useState)(!1),[R,O]=(0,p.useState)(null),[U,H]=(0,p.useState)({}),V=(0,p.useCallback)(async()=>{F(!0);try{let e=await (0,N.gI)();if("denied"===e)return console.warn("用户拒绝了地理位置权限"),A(""),"";let t=await (0,N.g_)();return A(t),t}catch(e){return console.warn("获取地理位置失败:",e),A(""),""}finally{F(!1)}},[]),B=(0,p.useCallback)(async(e,n)=>{S(!0),E("");try{let a=n||I,s="";s=e||("nearby"===a?_||"":M||"");let i="recommend"!==a,r=await (0,v.SX)({userId:i&&(null==t?void 0:t.userId)||"",token:i&&(null==t?void 0:t.token)||"",location:s,tab:a,page:1,limit:999});if(r.success&&r.data){let e=r.data.posts||[];Z(e),O(r.data.pagination||null);let t={};e.forEach(e=>{t[e.id]={isLove:!0===e.isLove||1===e.isLove,isCollect:!0===e.isCollect||1===e.isCollect,likes:e.likes||0,bookmarks:e.collects||0,isInteracting:!1}}),H(t)}else E("加载内容失败")}catch(e){E("加载内容时发生错误")}finally{S(!1)}},[t,_,M,I,i]);(0,p.useEffect)(()=>{let e=w.get("tab"),t=w.get("location");e&&q(e),t?("nearby"===e?A(t):T(t),B(t)):B()},[w]);let D=e=>{(null==t?void 0:t.userId)&&(null==t?void 0:t.token)?i.push("/square/".concat(e,"?userId=").concat(t.userId,"&token=").concat(t.token)):i.push("/square/".concat(e))},K=async(a,s)=>{if(s.stopPropagation(),!(null==t?void 0:t.userId)||!(null==t?void 0:t.token)||!n){i.push("/login");return}let r=U[a];if(null==r||!r.isInteracting){H(e=>({...e,[a]:{...e[a],isInteracting:!0}}));try{(await (0,v.v1)({userId:t.userId,token:t.token,productId:a,isLove:(null==r?void 0:r.isLove)?0:1})).success?H(e=>{var t,n,s;return{...e,[a]:{...e[a],isLove:!(null===(t=e[a])||void 0===t?void 0:t.isLove),likes:((null===(n=e[a])||void 0===n?void 0:n.likes)||0)+((null===(s=e[a])||void 0===s?void 0:s.isLove)?-1:1),isInteracting:!1}}}):alert(e("square.operationFailed"))}catch(t){console.error("点赞失败:",t),alert(e("square.operationFailed"))}finally{H(e=>({...e,[a]:{...e[a],isInteracting:!1}}))}}},$=async(a,s)=>{if(s.stopPropagation(),!(null==t?void 0:t.userId)||!(null==t?void 0:t.token)||!n){i.push("/login");return}let r=U[a];if(null==r||!r.isInteracting){H(e=>({...e,[a]:{...e[a],isInteracting:!0}}));try{(await (0,v.gQ)({userId:t.userId,token:t.token,productId:a,isCollect:(null==r?void 0:r.isCollect)?0:1})).success?H(e=>{var t,n,s;return{...e,[a]:{...e[a],isCollect:!(null===(t=e[a])||void 0===t?void 0:t.isCollect),bookmarks:((null===(n=e[a])||void 0===n?void 0:n.bookmarks)||0)+((null===(s=e[a])||void 0===s?void 0:s.isCollect)?-1:1),isInteracting:!1}}}):alert(e("square.operationFailed"))}catch(t){console.error("收藏失败:",t),alert(e("square.operationFailed"))}finally{H(e=>({...e,[a]:{...e[a],isInteracting:!1}}))}}},G=async(n,a)=>{if(a.stopPropagation(),(null==t?void 0:t.userId)&&(null==t?void 0:t.token))try{await (0,v._Z)({userId:t.userId,token:t.token,productId:n.id}),Z(e=>e.map(e=>e.id===n.id?{...e,shares:(e.shares||0)+1}:e))}catch(e){console.error("分享接口调用失败:",e)}try{navigator.share?await navigator.share({title:n.title||"Untitled",text:n.description||"",url:"".concat(window.location.origin,"/square/").concat(n.id)}):(await navigator.clipboard.writeText("".concat(window.location.origin,"/square/").concat(n.id)),alert(e("square.linkCopied")))}catch(e){"AbortError"!==e.name&&console.error("分享失败:",e)}};return(0,a.jsx)("div",{className:"min-h-screen bg-white",children:(0,a.jsxs)("main",{className:" flex min-h-[100vh] flex-col",children:[(0,a.jsx)(f.h,{showLanguage:!0,showSearch:!0,showUser:!0,userLink:"/personal-center"}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-2 pt-3 pb-2 border-b",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{let e="recommend";q(e),B(M,e)},className:"text-sm font-medium px-3 py-1.5 rounded-full transition-all font-poppins ".concat("recommend"===I?"bg-gradient-to-r from-orange-500 to-pink-500 text-white shadow-sm":"text-gray-600 hover:text-gray-800"),children:e("square.recommend")}),(0,a.jsx)("button",{onClick:()=>{if(!(null==t?void 0:t.userId)||!(null==t?void 0:t.token)){i.push("/login");return}let e="following";q(e),B(M,e)},className:"text-sm font-medium px-3 py-1.5 rounded-full transition-all font-poppins ".concat("following"===I?"bg-gradient-to-r from-orange-500 to-pink-500 text-white shadow-sm":"text-gray-600 hover:text-gray-800"),children:e("square.following")}),(0,a.jsx)("button",{onClick:async()=>{if(!(null==t?void 0:t.userId)||!(null==t?void 0:t.token)){i.push("/login");return}let e="nearby";q(e),B(await V(),e)},className:"text-sm font-medium px-3 py-1.5 rounded-full transition-all font-poppins ".concat("nearby"===I?"bg-gradient-to-r from-orange-500 to-pink-500 text-white shadow-sm":"text-gray-600 hover:text-gray-800"),children:e("square.nearby")})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(s.z,{variant:"ghost",size:"sm",onClick:()=>i.push("/region-select?from=square&tab=".concat(I)),className:"text-gray-600 hover:text-gray-800 px-2 py-1",children:(0,a.jsx)(r,{className:"h-4 w-4"})}),("nearby"===I&&_||"nearby"!==I&&M)&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-600 bg-gray-100 px-1 py-1 rounded-full max-w-20",children:[(0,a.jsx)(o.Z,{className:"h-3 w-3 flex-shrink-0"}),(0,a.jsx)("span",{className:"font-nunito truncate",children:"nearby"===I?_:M}),(0,a.jsx)("button",{onClick:()=>{"nearby"===I?A(""):T(""),i.push("/square"),B("")},className:"ml-1 hover:bg-gray-200 rounded-full p-0.5 transition-colors flex-shrink-0",title:e("square.clearFilter"),children:(0,a.jsx)(l.Z,{className:"h-3 w-3"})})]})]})]}),(L||P)&&(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsx)(k.TK,{size:"lg",text:P?e("square.gettingLocation"):e("square.loading")})}),z&&!L&&!P&&(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsx)(k.Te,{error:z,onRetry:()=>n&&B(_)})}),!L&&!z&&!P&&0===C.length&&(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center px-4 py-12",children:[(0,a.jsx)(c,{className:"h-16 w-16 text-gray-300 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:e("square.noContent")}),(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center max-w-sm",children:"recommend"===I?e("square.noRecommendContent"):n?e("square.noNearbyContent"):e("square.loginRequired")})]}),!L&&!z&&!P&&C.length>0&&(0,a.jsxs)("div",{className:"flex-1 px-2 py-2",children:[(0,a.jsx)("div",{className:"space-y-0",children:C.map((e,t)=>{var s,i,r,l,c,m,h,f,g,p;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"bg-white p-4 cursor-pointer hover:shadow-sm transition-shadow",onClick:()=>D(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(o.Z,{className:"h-3 w-3 text-gray-500"}),(0,a.jsx)("span",{className:"text-xs text-gray-600",children:e.location})]}),(0,a.jsx)("div",{className:"flex gap-2 mb-3 overflow-x-auto",children:e.images.map((t,n)=>(0,a.jsx)(b.d,{src:"".concat(j.bl.STATIC_URL).concat(t),alt:"Post ".concat(e.id," image ").concat(n+1),className:"w-34 h-24 object-cover rounded flex-shrink-0"},n))}),(0,a.jsx)("h3",{className:" text-gray-900 mb-2 text-sm font-nunito font-semibold",children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2 leading-relaxed font-inter",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("img",{src:"".concat(j.bl.STATIC_URL).concat(e.publisher.avatar),alt:e.publisher.nickname,className:"w-8 h-8 object-cover rounded-full"}),(0,a.jsx)("span",{className:"text-sm text-gray-600 font-nunito",children:e.publisher.nickname})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("button",{onClick:t=>$(e.id,t),disabled:!n||(null===(s=U[e.id])||void 0===s?void 0:s.isInteracting),className:"flex flex-col items-center gap-0.5 transition-colors ".concat((null===(i=U[e.id])||void 0===i?void 0:i.isCollect)?"text-blue-600":"text-gray-500 hover:text-gray-700"," ").concat(!n||(null===(r=U[e.id])||void 0===r?void 0:r.isInteracting)?"opacity-50 cursor-not-allowed":""),title:n?"":"请先登录",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 ".concat((null===(l=U[e.id])||void 0===l?void 0:l.isCollect)?"fill-current":"")}),(0,a.jsx)("span",{className:"text-xs font-nunito",children:(null===(c=U[e.id])||void 0===c?void 0:c.bookmarks)||e.collects||0})]}),(0,a.jsxs)("button",{onClick:t=>K(e.id,t),disabled:!n||(null===(m=U[e.id])||void 0===m?void 0:m.isInteracting),className:"flex flex-col items-center gap-0.5 transition-colors ".concat((null===(h=U[e.id])||void 0===h?void 0:h.isLove)?"text-red-500":"text-gray-500 hover:text-red-500"," ").concat(!n||(null===(f=U[e.id])||void 0===f?void 0:f.isInteracting)?"opacity-50 cursor-not-allowed":""),title:n?"":"请先登录",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 ".concat((null===(g=U[e.id])||void 0===g?void 0:g.isLove)?"fill-current":"")}),(0,a.jsx)("span",{className:"text-xs font-nunito",children:(null===(p=U[e.id])||void 0===p?void 0:p.likes)||e.likes||0})]}),(0,a.jsxs)("button",{onClick:t=>G(e,t),className:"flex flex-col items-center gap-0.5 text-gray-500 hover:text-gray-700 transition-colors",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs font-nunito",children:e.shares||0})]})]})]})]}),t<C.length-1&&(0,a.jsx)("div",{className:"mx-4 my-2",style:{borderBottom:"1px solid #e5e7eb"}})]},e.id)})}),R&&(0,a.jsx)("div",{className:"px-4 py-3 text-center text-xs text-gray-500",children:e("square.pagination").replace("{items}",R.totalItems.toString())})]}),(0,a.jsx)(g.$,{})]})})}},8444:function(e,t,n){"use strict";n.d(t,{$:function(){return c}});var a=n(7437),s=n(759),i=n(2869),r=n(4508);function o(){let{language:e,setLanguage:t,t:n}=(0,s.Z)();return(0,a.jsxs)("div",{className:"flex items-center gap-2 mr-1",children:[(0,a.jsx)(i.z,{variant:"ghost",size:"sm",className:(0,r.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:n("footer.language.en")}),(0,a.jsx)(i.z,{variant:"ghost",size:"sm",className:(0,r.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:n("footer.language.zh")})]})}var l=n(7648);function c(){let{t:e}=(0,s.Z)();return(0,a.jsx)("footer",{className:"mt-auto text-[11px] text-muted-foreground py-2 px-2 w-full font-inter",children:(0,a.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 font-inter",children:(0,a.jsx)(o,{})}),(0,a.jsxs)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,a.jsx)(l.default,{href:"/about",className:"text-muted-foreground font-inter",children:e("footer.links.about")}),(0,a.jsx)(l.default,{href:"/privacy",className:"text-muted-foreground font-inter",children:e("footer.links.privacy")}),(0,a.jsx)("span",{className:"text-muted-foreground font-inter",children:e("footer.copyright")})]})]})})}},8783:function(e,t,n){"use strict";n.d(t,{TK:function(){return l},Te:function(){return c},ub:function(){return d}});var a=n(7437),s=n(2869),i=n(9322),r=n(7168),o=n(759);function l(e){let{size:t="md",text:n,className:s=""}=e,{t:i}=(0,o.Z)(),r=n||i("common.loading");return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(s),children:[(0,a.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-[#11295b] ".concat({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t]," mb-2")}),r&&(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:r})]})}function c(e){let{error:t,onRetry:n,retryText:l,className:c=""}=e,{t:d}=(0,o.Z)(),u=l||d("common.retry");return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(c),children:[(0,a.jsx)(i.Z,{className:"h-8 w-8 text-red-500 mb-2"}),(0,a.jsx)("p",{className:"text-red-500 mb-4 text-center",children:t}),n&&(0,a.jsxs)(s.z,{onClick:n,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,a.jsx)(r.Z,{className:"h-4 w-4"}),u]})]})}function d(e){let{title:t,description:n,icon:s,action:i,className:r=""}=e;return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center text-center ".concat(r),children:[s&&(0,a.jsx)("div",{className:"mb-4",children:s}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),n&&(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:n}),i&&(0,a.jsx)("div",{children:i})]})}},5120:function(e,t,n){"use strict";n.d(t,{d:function(){return r}});var a=n(7437),s=n(2265);let i=(0,n(9205).Z)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);function r(e){let{src:t,alt:n,className:r="",fallbackSrc:o="/img/band.png",loading:l="lazy",onError:c,onLoad:d}=e,[u,x]=(0,s.useState)(!1),[m,h]=(0,s.useState)(!0);return u?(0,a.jsx)("div",{className:"bg-gray-200 flex items-center justify-center ".concat(r),children:(0,a.jsx)(i,{className:"h-8 w-8 text-gray-400"})}):(0,a.jsxs)("div",{className:"relative ".concat(r),children:[m&&(0,a.jsx)("div",{className:"absolute inset-0 bg-gray-200 animate-pulse flex items-center justify-center",children:(0,a.jsx)(i,{className:"h-8 w-8 text-gray-400"})}),(0,a.jsx)("img",{src:t,alt:n,className:"".concat(r," ").concat(m?"opacity-0":"opacity-100"," transition-opacity duration-300"),loading:l,onError:()=>{x(!0),h(!1),null==c||c()},onLoad:()=>{h(!1),null==d||d()}})]})}},4512:function(e,t,n){"use strict";async function a(e,t){try{if("geolocation"in navigator&&"reverseGeocode"in navigator)throw Error("浏览器不支持反向地理编码");let n=await fetch("https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(e,"&longitude=").concat(t,"&localityLanguage=zh"));if(!n.ok)throw Error("地理编码服务不可用");let a=await n.json(),s=[];return a.locality&&s.push(a.locality),a.principalSubdivision&&s.push(a.principalSubdivision),a.countryName&&s.push(a.countryName),s.join("，")||"".concat(e.toFixed(4),", ").concat(t.toFixed(4))}catch(n){return"".concat(e.toFixed(4),", ").concat(t.toFixed(4))}}async function s(e){try{let t=await function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5};return new Promise((t,n)=>{if(!navigator.geolocation){n({code:-1,message:"浏览器不支持地理位置功能"});return}navigator.geolocation.getCurrentPosition(e=>{t({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy})},e=>{let t="获取地理位置失败";switch(e.code){case e.PERMISSION_DENIED:t="用户拒绝了地理位置请求";break;case e.POSITION_UNAVAILABLE:t="地理位置信息不可用";break;case e.TIMEOUT:t="获取地理位置超时";break;default:t="获取地理位置时发生未知错误"}n({code:e.code,message:t})},e)})}(e);return await a(t.latitude,t.longitude)}catch(e){return console.warn("获取地理位置失败，使用默认位置:",e),"中国，北京"}}async function i(){if(!navigator.permissions)return"prompt";try{return(await navigator.permissions.query({name:"geolocation"})).state}catch(e){return"prompt"}}n.d(t,{gI:function(){return i},g_:function(){return s}})},1178:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});let a=(0,n(9205).Z)("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]])},9322:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});let a=(0,n(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},8997:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});let a=(0,n(9205).Z)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]])},3774:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});let a=(0,n(9205).Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},7168:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});let a=(0,n(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8919:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});let a=(0,n(9205).Z)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]])},2489:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});let a=(0,n(9205).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[516,51,282,971,117,744],function(){return e(e.s=9357)}),_N_E=e.O()}]);