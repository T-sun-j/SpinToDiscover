(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{9510:function(e,t,s){Promise.resolve().then(s.bind(s,1360))},1360:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var r=s(7437),n=s(2265),i=s(9376),a=s(4196),c=s(1839),l=s(2869),o=s(759),d=s(6281),u=s(2690),h=s(2451);let m=(0,s(9205).Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var x=s(8930),f=s(3145),p=s(6023),g=s(9116);function v(){let{t:e}=(0,o.Z)(),{authInfo:t}=(0,d.a)(),s=(0,i.useRouter)(),[v,j]=(0,n.useState)("all"),[y,N]=(0,n.useState)(""),[w,b]=(0,n.useState)([]),[k,C]=(0,n.useState)(!1),[E,Z]=(0,n.useState)([]),[F,R]=(0,n.useState)([]),[S,L]=(0,n.useState)(!1),[z,I]=(0,n.useState)(""),[U,A]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=localStorage.getItem("searchHistory");e&&b(JSON.parse(e))},[]),(0,n.useEffect)(()=>{if(!k)return;let e=e=>{e.target.closest("[data-dropdown-container]")||C(!1)},t=setTimeout(()=>{document.addEventListener("click",e)},0);return()=>{clearTimeout(t),document.removeEventListener("click",e)}},[k]);let M=e=>{b(e),localStorage.setItem("searchHistory",JSON.stringify(e))},P=async(s,r)=>{if(!s.trim()){Z([]),R([]),A(!1);return}if(!t){I(e("square.loginRequired"));return}L(!0),I("");try{let n=await (0,p.u9)({userId:t.userId,token:t.token,typeid:r,title:s.trim()});n.success?("all"===r||"users"===r?Z(n.userDataList||[]):Z([]),"all"===r||"articles"===r?R(n.articleDataList||[]):R([])):(I(n.message||e("search.noResults")),Z([]),R([])),A(!0)}catch(t){console.error("搜索失败:",t),t instanceof Error&&"TOKEN_EXPIRED"===t.message?I("登录已过期，请重新登录"):I(t instanceof Error?t.message:e("search.noResults")),Z([]),R([]),A(!0)}finally{L(!1)}},q=()=>{y.trim()&&(M([y.trim(),...w.filter(e=>e!==y.trim())].slice(0,10)),P(y.trim(),v))},T=e=>{N(e),P(e,v)},_=e=>{s.push("/personal/".concat(e))},O=e=>{s.push("/square/".concat(e))};return e("search.searchConditions.all"),e("search.searchConditions.articles"),e("search.searchConditions.users"),(0,r.jsx)(u.a,{children:(0,r.jsx)("div",{className:"min-h-screen bg-white",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto bg-white min-h-screen relative",children:[(0,r.jsx)(a.h,{showUser:!0,logoLink:"/"}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 z-100",children:[(0,r.jsx)("h1",{className:"text-xl font-poppins text-[#0F1728] font-semibold",children:e("search.title")}),(0,r.jsx)("button",{onClick:()=>{s.push("/square")},className:"text-[#0F1728] hover:text-[#0F1728]",children:(0,r.jsx)(h.Z,{className:"h-7 w-7 z-10"})})]}),(0,r.jsx)("div",{className:"px-4 mb-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"text",value:y,onChange:e=>N(e.target.value),onKeyPress:e=>{"Enter"===e.key&&q()},placeholder:e("search.searchPlaceholder"),className:"flex-1 text-[#11295b] px-3 py-2 bg-gray-100 border-0 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 h-10"}),(0,r.jsx)(l.z,{variant:"ghost",size:"icon",className:"text-foreground ml-2",onClick:q,children:(0,r.jsx)(f.default,{src:"/img/search.png",alt:"search",width:28,height:28,className:"h-7 w-7 z-10"})})]})}),S?(0,r.jsx)("div",{className:"flex justify-center items-center py-12 px-4",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):z?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-red-500 text-sm",children:z})}):U?(0,r.jsxs)("div",{className:"space-y-6 px-4",children:[E.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-[17px] text-[#0F1728] font-poppins font-semibold mb-3",children:e("search.users")}),(0,r.jsx)("div",{className:"flex gap-4 overflow-x-auto pb-2 scrollbar-hide",children:E.map(e=>(0,r.jsxs)("button",{onClick:()=>_(e.userId),className:"flex flex-col items-center gap-2 flex-shrink-0 hover:opacity-80 transition-opacity",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:e.avatar?(0,r.jsx)(f.default,{src:(0,g.nJ)(e.avatar),alt:e.name||"User",width:64,height:64,className:"w-full h-full object-cover"}):(0,r.jsx)(m,{className:"w-8 h-8 text-gray-500"})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("p",{className:"text-[#0F1728] text-sm font-medium",children:e.name||"User"})})]},e.userId))})]}),E.length>0&&F.length>0&&(0,r.jsx)("div",{style:{borderBottom:"1px solid #e5e7eb"}}),F.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-[17px] text-[#0F1728] font-poppins font-semibold mb-3",children:e("search.articles")}),(0,r.jsx)("div",{className:"",children:F.map(e=>(0,r.jsxs)("button",{onClick:()=>O(e.id),className:"w-full text-left  hover:bg-gray-50 transition-colors",children:[(0,r.jsx)("h3",{className:"text-[17px] font-poppins font-semibold text-[#12295B] italic mb-1",children:e.title}),e.description&&(0,r.jsx)("p",{className:"text-[#20313B] text-sm mb-2 leading-relaxed line-clamp-2",children:e.description})]},e.id))})]}),0===E.length&&0===F.length&&y&&!z&&(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:e("search.noResults")})})]}):w.length>0&&(0,r.jsxs)("div",{className:"px-4 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between ",children:[(0,r.jsx)("h2",{className:" text-[17px] text-[#0F1728] font-poppins font-semibold",children:e("search.history")}),(0,r.jsx)(l.z,{variant:"ghost",size:"sm",onClick:()=>{M([])},className:"text-[#0F1728] hover:text-[#0F1728] p-1",children:(0,r.jsx)(x.Z,{className:"h-6 w-6"})})]}),(0,r.jsx)("div",{className:"space-y-1",children:w.map((e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{onClick:()=>T(e),className:"block w-full text-left px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md transition-colors text-sm",children:e}),t!==w.length-1&&(0,r.jsx)("div",{style:{borderBottom:"1px solid #e5e7eb"}})]},t))})]}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0",children:(0,r.jsx)(c.$,{})})]})})})}},2690:function(e,t,s){"use strict";s.d(t,{a:function(){return u}});var r=s(7437),n=s(2265),i=s(9376),a=s(6281),c=s(759),l=s(8783);let o=["/","/square","/login","/register","/forgot-password","/change-password","/personalization","/about","/privacy"];function d(e){return o.some(t=>"/"===t?"/"===e:e.startsWith(t))}function u(e){let{children:t,fallback:s}=e,{isAuthenticated:o,authInfo:u}=(0,a.a)(),{t:h}=(0,c.Z)(),m=(0,i.useRouter)(),x=(0,i.usePathname)(),[f,p]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{let e=setTimeout(()=>{p(!0)},100);return()=>clearTimeout(e)},[]),(0,n.useEffect)(()=>{if(!f){console.log("AuthGuard: Waiting for initialization...");return}if(console.log("AuthGuard useEffect triggered:",{pathname:x,search:window.location.search,isAuthenticated:o,hasAuthInfo:!!u,isPublic:d(x),isInitialized:f}),d(x)){console.log("Public path, no auth check needed");return}if(o&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token))console.log("User is authenticated, allowing access");else{let e;if(console.log("User not authenticated, checking for redirect loop"),function(e,t){if(console.log("Checking for redirect loop:",{pathname:e,search:t}),e.startsWith("/login"))return console.log("Current path is login page, preventing redirect"),!0;let s=new URLSearchParams(t).get("redirect");if(s){console.log("Found redirect parameter:",s);try{let e=decodeURIComponent(s);if(console.log("Decoded redirect:",e),e.includes("/login"))return console.log("Redirect contains /login, preventing loop"),!0;if(e.includes("redirect="))return console.log("Redirect contains nested redirect parameter, preventing loop"),!0;if(e.includes("?"))return console.log("Redirect contains query parameters, preventing loop"),!0;if(e.includes("%2Flogin")||e.includes("%252Flogin"))return console.log("Redirect contains encoded login path, preventing loop"),!0}catch(e){return console.warn("Failed to decode redirect parameter:",s,e),!0}}return console.log("No redirect loop detected"),!1}(x,window.location.search)){console.warn("Prevented redirect loop to login page");return}if("/login"===x){console.warn("Already on login page, preventing redirect");return}window.location.search.includes("redirect=")?(e="/login",console.log("Existing redirect detected, using default login URL")):console.log("Redirecting to login:",e="/login?redirect=".concat(encodeURIComponent(x))),m.push(e)}},[o,u,x,m,f]),d(x))?(0,r.jsx)(r.Fragment,{children:t}):o&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token)?(0,r.jsx)(r.Fragment,{children:t}):s||(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)(l.TK,{size:"lg",text:h("common.verifying")})})})}},1839:function(e,t,s){"use strict";s.d(t,{$:function(){return l}});var r=s(7437),n=s(759),i=s(3145);function a(e){let{transparent:t=!1}=e,{language:s,setLanguage:a}=(0,n.Z)();return(0,r.jsxs)("button",{onClick:()=>{a("en"===s?"zh":"en")},className:"flex items-center ".concat(t?"text-white":"text-[#0F1728]"," hover:opacity-80 transition-opacity"),"aria-label":"Switch to ".concat("en"===s?"Chinese":"English"),children:[(0,r.jsx)(i.default,{src:t?"/img/lang.png":"/img/lang-d.png",alt:"Language",width:24,height:24,className:"h-4 w-4"}),(0,r.jsx)("span",{className:"text-[10px] font-medium ml-1 ".concat(t?"text-white":"text-[#0F1728]"),children:"en"===s?"EN":"CN"})]})}var c=s(7648);function l(e){let{transparent:t=!1}=e,{t:s}=(0,n.Z)();return(0,r.jsx)("footer",{className:"mt-auto text-[10px] py-4 px-4 w-full font-inter ".concat(t?"text-white":"text-[#0F1728]"),children:(0,r.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 font-inter",children:(0,r.jsx)(a,{transparent:t})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,r.jsx)(c.default,{href:"/about",className:"".concat(t?"text-white":"text-[#0F1728]"," font-inter"),children:s("footer.links.about")}),(0,r.jsx)(c.default,{href:"/privacy",className:"".concat(t?"text-white":"text-[#0F1728]"," font-inter"),children:s("footer.links.privacy")}),(0,r.jsx)("span",{className:"".concat(t?"text-white":"text-[#0F1728]"," font-inter"),children:s("footer.copyright")}),(0,r.jsx)(i.default,{src:t?"/img/logo-1.png":"/img/logo-2.png",alt:"Language",width:52,height:22,className:"h-5 w-auto"})]})]})})}},8783:function(e,t,s){"use strict";s.d(t,{TK:function(){return l},Te:function(){return o},ub:function(){return d}});var r=s(7437),n=s(2869),i=s(9322),a=s(7168),c=s(759);function l(e){let{size:t="md",text:s,className:n=""}=e,{t:i}=(0,c.Z)(),a=s||i("common.loading");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(n),children:[(0,r.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-[#11295b] ".concat({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t]," mb-2")}),a&&(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:a})]})}function o(e){let{error:t,onRetry:s,retryText:l,className:o=""}=e,{t:d}=(0,c.Z)(),u=l||d("common.retry");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(o),children:[(0,r.jsx)(i.Z,{className:"h-8 w-8 text-red-500 mb-2"}),(0,r.jsx)("p",{className:"text-red-500 mb-4 text-center",children:t}),s&&(0,r.jsxs)(n.z,{onClick:s,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,r.jsx)(a.Z,{className:"h-4 w-4"}),u]})]})}function d(e){let{title:t,description:s,icon:n,action:i,className:a=""}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center text-center ".concat(a),children:[n&&(0,r.jsx)("div",{className:"mb-4",children:n}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),s&&(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:s}),i&&(0,r.jsx)("div",{children:i})]})}},9205:function(e,t,s){"use strict";s.d(t,{Z:function(){return u}});var r=s(2265);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),a=e=>{let t=i(e);return t.charAt(0).toUpperCase()+t.slice(1)},c=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()},l=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,r.forwardRef)((e,t)=>{let{color:s="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:d="",children:u,iconNode:h,...m}=e;return(0,r.createElement)("svg",{ref:t,...o,width:n,height:n,stroke:s,strokeWidth:a?24*Number(i)/Number(n):i,className:c("lucide",d),...!u&&!l(m)&&{"aria-hidden":"true"},...m},[...h.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(u)?u:[u]])}),u=(e,t)=>{let s=(0,r.forwardRef)((s,i)=>{let{className:l,...o}=s;return(0,r.createElement)(d,{ref:i,iconNode:t,className:c("lucide-".concat(n(a(e))),"lucide-".concat(e),l),...o})});return s.displayName=a(e),s}},2451:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9322:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},7168:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8930:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])}},function(e){e.O(0,[604,51,624,971,117,744],function(){return e(e.s=9510)}),_N_E=e.O()}]);