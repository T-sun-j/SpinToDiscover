(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{9510:function(e,t,s){Promise.resolve().then(s.bind(s,1360))},1360:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y}});var r=s(7437),n=s(2265),a=s(9376),l=s(9512),i=s(8444),c=s(2869),o=s(759),d=s(6281),u=s(2690),h=s(875),m=s(3247);let x=(0,s(9205).Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var f=s(8930),g=s(3145),p=s(6023),v=s(9116);function y(){var e;let{t}=(0,o.Z)(),{authInfo:s}=(0,d.a)(),y=(0,a.useRouter)(),[j,b]=(0,n.useState)("all"),[N,w]=(0,n.useState)(""),[k,C]=(0,n.useState)([]),[Z,R]=(0,n.useState)(!1),[z,S]=(0,n.useState)([]),[E,M]=(0,n.useState)([]),[I,L]=(0,n.useState)(!1),[q,P]=(0,n.useState)(""),[U,_]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=localStorage.getItem("searchHistory");e&&C(JSON.parse(e))},[]);let F=e=>{C(e),localStorage.setItem("searchHistory",JSON.stringify(e))},T=async(e,r)=>{if(!e.trim()){S([]),M([]),_(!1);return}if(!s){P(t("square.loginRequired"));return}L(!0),P("");try{let n=await (0,p.u9)({userId:s.userId,token:s.token,typeid:r,title:e.trim()});n.success?("all"===r||"users"===r?S(n.userDataList||[]):S([]),"all"===r||"articles"===r?M(n.articleDataList||[]):M([])):(P(n.message||t("search.noResults")),S([]),M([])),_(!0)}catch(e){console.error("搜索失败:",e),e instanceof Error&&"TOKEN_EXPIRED"===e.message?P("登录已过期，请重新登录"):P(e instanceof Error?e.message:t("search.noResults")),S([]),M([]),_(!0)}finally{L(!1)}},H=()=>{N.trim()&&(F([N.trim(),...k.filter(e=>e!==N.trim())].slice(0,10)),T(N.trim(),j))},O=e=>{w(e),T(e,j)},A=e=>{y.push("/personal/".concat(e))},D=e=>{y.push("/square/".concat(e))},K=[{value:"all",label:t("search.searchConditions.all")},{value:"articles",label:t("search.searchConditions.articles")},{value:"users",label:t("search.searchConditions.users")},{value:"brands",label:t("search.searchConditions.brands")}];return(0,r.jsx)(u.a,{children:(0,r.jsx)("div",{className:"min-h-screen bg-white",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto bg-white min-h-screen relative",children:[(0,r.jsx)(l.h,{showLanguage:!0,showUser:!0,logoLink:"/",className:"border-b border-gray-200"}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-4",children:[(0,r.jsx)("h1",{className:"text-xl text-[#11295b] font-poppins",children:t("search.title")}),(0,r.jsx)("button",{onClick:()=>{y.push("/square")},className:"text-[#11295b] hover:text-[#11295b]",children:(0,r.jsx)("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})]}),(0,r.jsx)("div",{className:"px-4 mb-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)(c.z,{variant:"outline",onClick:()=>R(!Z),className:"flex items-center gap-1 bg-gray-100 border-gray-300 text-gray-700 px-3 py-2 h-10 min-w-[80px]",children:[null===(e=K.find(e=>e.value===j))||void 0===e?void 0:e.label,(0,r.jsx)(h.Z,{className:"h-4 w-4"})]}),Z&&(0,r.jsx)("div",{className:"absolute top-full text-[#11295b] left-0 mt-1 w-32 bg-white border border-gray-300 rounded-md shadow-lg z-10",children:K.map(e=>(0,r.jsx)("button",{onClick:()=>{b(e.value),R(!1),N.trim()&&T(N.trim(),e.value)},className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 first:rounded-t-md last:rounded-b-md",children:e.label},e.value))})]}),(0,r.jsx)("input",{type:"text",value:N,onChange:e=>w(e.target.value),onKeyPress:e=>{"Enter"===e.key&&H()},placeholder:t("search.searchPlaceholder"),className:"flex-1 text-[#11295b] px-3 py-2 bg-gray-100 border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-10"}),(0,r.jsx)(c.z,{onClick:H,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 h-10",children:(0,r.jsx)(m.Z,{className:"h-4 w-4"})})]})}),I?(0,r.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):q?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-red-500 text-sm",children:q})}):U?(0,r.jsxs)("div",{className:"space-y-6",children:[z.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-base font-medium text-gray-900 mb-3 font-poppins",children:t("search.users")}),(0,r.jsx)("div",{className:"space-y-2",children:z.map(e=>(0,r.jsxs)("button",{onClick:()=>A(e.id),className:"w-full flex items-center gap-3 p-2 hover:bg-gray-50 rounded-md transition-colors",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:e.avatar?(0,r.jsx)(g.default,{src:(0,v.nJ)(e.avatar),alt:e.name||"User",width:32,height:32,className:"w-full h-full object-cover"}):(0,r.jsx)(x,{className:"w-4 h-4 text-gray-500"})}),(0,r.jsx)("div",{className:"flex-1 text-left",children:(0,r.jsx)("p",{className:"text-gray-500 text-xs",children:e.addtime})})]},e.id))})]}),E.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-base font-medium text-gray-900 mb-3 font-poppins",children:t("search.articles")}),(0,r.jsx)("div",{className:"space-y-3",children:E.map(e=>(0,r.jsxs)("button",{onClick:()=>D(e.id),className:"w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:e.title}),e.description&&(0,r.jsx)("p",{className:"text-gray-600 text-xs mb-2 leading-relaxed line-clamp-2",children:e.description}),(0,r.jsx)("p",{className:"text-gray-500 text-xs",children:e.addtime})]},e.id))})]}),0===z.length&&0===E.length&&N&&!q&&(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:t("search.noResults")})})]}):k.length>0&&(0,r.jsxs)("div",{className:"px-4 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("h2",{className:"text-base font-medium text-gray-900 font-poppins",children:t("search.history")}),(0,r.jsx)(c.z,{variant:"ghost",size:"sm",onClick:()=>{F([])},className:"text-gray-500 hover:text-gray-700 p-1",children:(0,r.jsx)(f.Z,{className:"h-4 w-4"})})]}),(0,r.jsx)("div",{className:"space-y-1",children:k.map((e,t)=>(0,r.jsx)("button",{onClick:()=>O(e),className:"block w-full text-left px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md transition-colors text-sm",children:e},t))})]}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0",children:(0,r.jsx)(i.$,{})})]})})})}},2690:function(e,t,s){"use strict";s.d(t,{a:function(){return u}});var r=s(7437),n=s(2265),a=s(9376),l=s(6281),i=s(759),c=s(8783);let o=["/","/square","/login","/register","/forgot-password","/change-password","/personalization","/about","/privacy"];function d(e){return o.some(t=>"/"===t?"/"===e:e.startsWith(t))}function u(e){let{children:t,fallback:s}=e,{isAuthenticated:o,authInfo:u}=(0,l.a)(),{t:h}=(0,i.Z)(),m=(0,a.useRouter)(),x=(0,a.usePathname)(),[f,g]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{let e=setTimeout(()=>{g(!0)},100);return()=>clearTimeout(e)},[]),(0,n.useEffect)(()=>{if(!f){console.log("AuthGuard: Waiting for initialization...");return}if(console.log("AuthGuard useEffect triggered:",{pathname:x,search:window.location.search,isAuthenticated:o,hasAuthInfo:!!u,isPublic:d(x),isInitialized:f}),d(x)){console.log("Public path, no auth check needed");return}if(o&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token))console.log("User is authenticated, allowing access");else{let e;if(console.log("User not authenticated, checking for redirect loop"),function(e,t){if(console.log("Checking for redirect loop:",{pathname:e,search:t}),e.startsWith("/login"))return console.log("Current path is login page, preventing redirect"),!0;let s=new URLSearchParams(t).get("redirect");if(s){console.log("Found redirect parameter:",s);try{let e=decodeURIComponent(s);if(console.log("Decoded redirect:",e),e.includes("/login"))return console.log("Redirect contains /login, preventing loop"),!0;if(e.includes("redirect="))return console.log("Redirect contains nested redirect parameter, preventing loop"),!0;if(e.includes("?"))return console.log("Redirect contains query parameters, preventing loop"),!0;if(e.includes("%2Flogin")||e.includes("%252Flogin"))return console.log("Redirect contains encoded login path, preventing loop"),!0}catch(e){return console.warn("Failed to decode redirect parameter:",s,e),!0}}return console.log("No redirect loop detected"),!1}(x,window.location.search)){console.warn("Prevented redirect loop to login page");return}if("/login"===x){console.warn("Already on login page, preventing redirect");return}window.location.search.includes("redirect=")?(e="/login",console.log("Existing redirect detected, using default login URL")):console.log("Redirecting to login:",e="/login?redirect=".concat(encodeURIComponent(x))),m.push(e)}},[o,u,x,m,f]),d(x))?(0,r.jsx)(r.Fragment,{children:t}):o&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token)?(0,r.jsx)(r.Fragment,{children:t}):s||(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)(c.TK,{size:"lg",text:h("common.verifying")})})})}},8444:function(e,t,s){"use strict";s.d(t,{$:function(){return o}});var r=s(7437),n=s(759),a=s(2869),l=s(4508);function i(){let{language:e,setLanguage:t,t:s}=(0,n.Z)();return(0,r.jsxs)("div",{className:"flex items-center gap-2 mr-1",children:[(0,r.jsx)(a.z,{variant:"ghost",size:"sm",className:(0,l.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:s("footer.language.en")}),(0,r.jsx)(a.z,{variant:"ghost",size:"sm",className:(0,l.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:s("footer.language.zh")})]})}var c=s(7648);function o(){let{t:e}=(0,n.Z)();return(0,r.jsx)("footer",{className:"mt-auto text-[11px] text-muted-foreground py-2 px-2 w-full font-inter",children:(0,r.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 font-inter",children:(0,r.jsx)(i,{})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,r.jsx)(c.default,{href:"/about",className:"text-muted-foreground font-inter",children:e("footer.links.about")}),(0,r.jsx)(c.default,{href:"/privacy",className:"text-muted-foreground font-inter",children:e("footer.links.privacy")}),(0,r.jsx)("span",{className:"text-muted-foreground font-inter",children:e("footer.copyright")})]})]})})}},8783:function(e,t,s){"use strict";s.d(t,{TK:function(){return c},Te:function(){return o},ub:function(){return d}});var r=s(7437),n=s(2869),a=s(9322),l=s(7168),i=s(759);function c(e){let{size:t="md",text:s,className:n=""}=e,{t:a}=(0,i.Z)(),l=s||a("common.loading");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(n),children:[(0,r.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-[#11295b] ".concat({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t]," mb-2")}),l&&(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:l})]})}function o(e){let{error:t,onRetry:s,retryText:c,className:o=""}=e,{t:d}=(0,i.Z)(),u=c||d("common.retry");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(o),children:[(0,r.jsx)(a.Z,{className:"h-8 w-8 text-red-500 mb-2"}),(0,r.jsx)("p",{className:"text-red-500 mb-4 text-center",children:t}),s&&(0,r.jsxs)(n.z,{onClick:s,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),u]})]})}function d(e){let{title:t,description:s,icon:n,action:a,className:l=""}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center text-center ".concat(l),children:[n&&(0,r.jsx)("div",{className:"mb-4",children:n}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),s&&(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:s}),a&&(0,r.jsx)("div",{children:a})]})}},875:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},9322:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},7168:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8930:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])}},function(e){e.O(0,[516,51,282,971,117,744],function(){return e(e.s=9510)}),_N_E=e.O()}]);