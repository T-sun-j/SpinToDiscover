(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{909:function(e,t,s){Promise.resolve().then(s.bind(s,1856))},1856:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var r=s(7437),n=s(2869),o=s(2451),i=s(9345),l=s(6337),a=s(7168),c=s(759),d=s(9512),u=s(2690),g=s(2265),f=s(9376),h=s(6281),m=s(6023);function x(){let{t:e}=(0,c.Z)(),t=(0,f.useRouter)(),{authInfo:s,getEmail:x,getUserId:p,getToken:y}=(0,h.a)(),[w,v]=(0,g.useState)({email:"",password:"",confirmPassword:""}),[j,b]=(0,g.useState)(""),[N,k]=(0,g.useState)(""),[Z,R]=(0,g.useState)(!1);(0,g.useEffect)(()=>{let e=x();e&&v(t=>({...t,email:e}))},[x]);let E=async s=>{if(s.preventDefault(),R(!0),b(""),k(""),w.password!==w.confirmPassword){b(e("auth.passwordsNotMatch")),R(!1);return}if(w.password.length<6){b(e("settings.passwordTooShort")),R(!1);return}let r=p(),n=y(),o=x();if(!r||!n||!o){b(e("settings.authError")),R(!1);return}try{console.log("Reset password attempt for:",{email:o,userId:r,token:"***"});let s=await (0,m.c0)(o,w.password,r,n);console.log("Reset password response:",s),s.success?(k(e("settings.resetSuccess")),v(e=>({...e,password:"",confirmPassword:""})),setTimeout(()=>{t.push("/personal-center")},3e3)):b(s.message||s.error||e("settings.resetError"))}catch(t){console.error("Reset password error:",t),b(t instanceof Error?t.message:e("settings.resetError"))}finally{R(!1)}};return(0,r.jsx)(u.a,{children:(0,r.jsxs)("main",{className:"flex min-h-dvh flex-col bg-white",children:[(0,r.jsx)(d.h,{showLanguage:!0}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-4",children:[(0,r.jsx)("h1",{className:"text-xl text-[#11295b]",children:e("settings.setupTitle")}),(0,r.jsx)("button",{className:"text-[#11295b] hover:text-[#11295b]",onClick:()=>{t.back()},children:(0,r.jsx)(o.Z,{className:"h-7 w-7"})})]}),(0,r.jsxs)("form",{onSubmit:E,className:"flex-1 space-y-6 px-6",children:[(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(i.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),(0,r.jsx)("input",{type:"email",value:w.email,placeholder:e("settings.currentEmail"),className:"w-full rounded-lg bg-gray-100 px-10 py-3 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/60 cursor-not-allowed",readOnly:!0,disabled:!0})]})}),(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(l.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),(0,r.jsx)("input",{type:"password",value:w.password,onChange:e=>v({...w,password:e.target.value}),placeholder:e("settings.newPassword"),className:"w-full rounded-lg bg-gray-100 px-10 py-3 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/60",required:!0})]})}),(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(l.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),(0,r.jsx)("input",{type:"password",value:w.confirmPassword,onChange:e=>v({...w,confirmPassword:e.target.value}),placeholder:e("settings.confirmPassword"),className:"w-full rounded-lg bg-gray-100 px-10 py-3 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/60",required:!0})]})}),j&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-500 text-sm font-inter",children:[(0,r.jsx)(a.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:j})]}),N&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-500 text-sm font-inter",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500"}),(0,r.jsx)("span",{children:N})]}),(0,r.jsx)(n.z,{type:"submit",className:"w-full bg-[#11295b] text-white shadow-md rounded-lg font-nunito font-bold",size:"lg",disabled:Z,children:Z?e("settings.submitting"):e("settings.submit")})]})]})})}},2690:function(e,t,s){"use strict";s.d(t,{a:function(){return u}});var r=s(7437),n=s(2265),o=s(9376),i=s(6281),l=s(759),a=s(8783);let c=["/","/square","/login","/register","/forgot-password","/change-password","/personalization","/about","/privacy"];function d(e){return c.some(t=>"/"===t?"/"===e:e.startsWith(t))}function u(e){let{children:t,fallback:s}=e,{isAuthenticated:c,authInfo:u}=(0,i.a)(),{t:g}=(0,l.Z)(),f=(0,o.useRouter)(),h=(0,o.usePathname)(),[m,x]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{let e=setTimeout(()=>{x(!0)},100);return()=>clearTimeout(e)},[]),(0,n.useEffect)(()=>{if(!m){console.log("AuthGuard: Waiting for initialization...");return}if(console.log("AuthGuard useEffect triggered:",{pathname:h,search:window.location.search,isAuthenticated:c,hasAuthInfo:!!u,isPublic:d(h),isInitialized:m}),d(h)){console.log("Public path, no auth check needed");return}if(c&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token))console.log("User is authenticated, allowing access");else{let e;if(console.log("User not authenticated, checking for redirect loop"),function(e,t){if(console.log("Checking for redirect loop:",{pathname:e,search:t}),e.startsWith("/login"))return console.log("Current path is login page, preventing redirect"),!0;let s=new URLSearchParams(t).get("redirect");if(s){console.log("Found redirect parameter:",s);try{let e=decodeURIComponent(s);if(console.log("Decoded redirect:",e),e.includes("/login"))return console.log("Redirect contains /login, preventing loop"),!0;if(e.includes("redirect="))return console.log("Redirect contains nested redirect parameter, preventing loop"),!0;if(e.includes("?"))return console.log("Redirect contains query parameters, preventing loop"),!0;if(e.includes("%2Flogin")||e.includes("%252Flogin"))return console.log("Redirect contains encoded login path, preventing loop"),!0}catch(e){return console.warn("Failed to decode redirect parameter:",s,e),!0}}return console.log("No redirect loop detected"),!1}(h,window.location.search)){console.warn("Prevented redirect loop to login page");return}if("/login"===h){console.warn("Already on login page, preventing redirect");return}window.location.search.includes("redirect=")?(e="/login",console.log("Existing redirect detected, using default login URL")):console.log("Redirecting to login:",e="/login?redirect=".concat(encodeURIComponent(h))),f.push(e)}},[c,u,h,f,m]),d(h))?(0,r.jsx)(r.Fragment,{children:t}):c&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token)?(0,r.jsx)(r.Fragment,{children:t}):s||(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)(a.TK,{size:"lg",text:g("common.verifying")})})})}},8783:function(e,t,s){"use strict";s.d(t,{TK:function(){return a},Te:function(){return c},ub:function(){return d}});var r=s(7437),n=s(2869),o=s(9322),i=s(7168),l=s(759);function a(e){let{size:t="md",text:s,className:n=""}=e,{t:o}=(0,l.Z)(),i=s||o("common.loading");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(n),children:[(0,r.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-[#11295b] ".concat({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t]," mb-2")}),i&&(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:i})]})}function c(e){let{error:t,onRetry:s,retryText:a,className:c=""}=e,{t:d}=(0,l.Z)(),u=a||d("common.retry");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(c),children:[(0,r.jsx)(o.Z,{className:"h-8 w-8 text-red-500 mb-2"}),(0,r.jsx)("p",{className:"text-red-500 mb-4 text-center",children:t}),s&&(0,r.jsxs)(n.z,{onClick:s,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),u]})]})}function d(e){let{title:t,description:s,icon:n,action:o,className:i=""}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center text-center ".concat(i),children:[n&&(0,r.jsx)("div",{className:"mb-4",children:n}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),s&&(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:s}),o&&(0,r.jsx)("div",{children:o})]})}},2451:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9322:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6337:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},9345:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},7168:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},function(e){e.O(0,[516,51,282,971,117,744],function(){return e(e.s=909)}),_N_E=e.O()}]);