(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{909:function(e,t,r){Promise.resolve().then(r.bind(r,1856))},1856:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var s=r(7437),n=r(2869),o=r(2451),i=r(9345),l=r(6337),a=r(7168),c=r(759),d=r(4196),u=r(2690),f=r(2265),g=r(9376),h=r(6281),m=r(6023);function p(){let{t:e}=(0,c.Z)(),t=(0,g.useRouter)(),{authInfo:r,getEmail:p,getUserId:x,getToken:w}=(0,h.a)(),[y,v]=(0,f.useState)({email:"",password:"",confirmPassword:""}),[j,N]=(0,f.useState)(""),[b,k]=(0,f.useState)(""),[Z,C]=(0,f.useState)(!1);(0,f.useEffect)(()=>{let e=p();e&&v(t=>({...t,email:e}))},[p]);let E=async r=>{if(r.preventDefault(),C(!0),N(""),k(""),y.password!==y.confirmPassword){N(e("auth.passwordsNotMatch")),C(!1);return}if(y.password.length<6){N(e("settings.passwordTooShort")),C(!1);return}let s=x(),n=w(),o=p();if(!s||!n||!o){N(e("settings.authError")),C(!1);return}try{console.log("Reset password attempt for:",{email:o,userId:s,token:"***"});let r=await (0,m.c0)(o,y.password,s,n);console.log("Reset password response:",r),r.success?(k(e("settings.resetSuccess")),v(e=>({...e,password:"",confirmPassword:""})),setTimeout(()=>{t.push("/personal-center")},3e3)):N(r.message||r.error||e("settings.resetError"))}catch(t){console.error("Reset password error:",t),N(t instanceof Error?t.message:e("settings.resetError"))}finally{C(!1)}};return(0,s.jsx)(u.a,{children:(0,s.jsxs)("main",{className:"flex min-h-dvh flex-col bg-white",children:[(0,s.jsx)(d.h,{}),(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 z-100",children:[(0,s.jsx)("h1",{className:"text-xl font-poppins text-[#0F1728] font-semibold",children:e("settings.setupTitle")}),(0,s.jsx)("button",{className:"text-[#0F1728] hover:text-[#0F1728]",onClick:()=>{t.back()},children:(0,s.jsx)(o.Z,{className:"h-7 w-7 z-10"})})]}),(0,s.jsxs)("form",{onSubmit:E,className:"flex-1 space-y-6 px-6",children:[(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(i.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),(0,s.jsx)("input",{type:"email",value:y.email,placeholder:e("settings.currentEmail"),className:"w-full rounded-full bg-gray-100 px-10 py-3 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/60 cursor-not-allowed",readOnly:!0,disabled:!0})]})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(l.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),(0,s.jsx)("input",{type:"password",value:y.password,onChange:e=>v({...y,password:e.target.value}),placeholder:e("settings.newPassword"),className:"w-full rounded-full bg-gray-100 px-10 py-3 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/60",required:!0})]})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(l.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),(0,s.jsx)("input",{type:"password",value:y.confirmPassword,onChange:e=>v({...y,confirmPassword:e.target.value}),placeholder:e("settings.confirmPassword"),className:"w-full rounded-full bg-gray-100 px-10 py-3 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/60",required:!0})]})}),j&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-red-500 text-sm font-inter",children:[(0,s.jsx)(a.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:j})]}),b&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-green-500 text-sm font-inter",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500"}),(0,s.jsx)("span",{children:b})]}),(0,s.jsx)(n.z,{type:"submit",className:"w-full bg-[#11295b] text-white shadow-md rounded-lg font-nunito font-bold",size:"lg",disabled:Z,children:Z?e("settings.submitting"):e("settings.submit")})]})]})})}},2690:function(e,t,r){"use strict";r.d(t,{a:function(){return u}});var s=r(7437),n=r(2265),o=r(9376),i=r(6281),l=r(759),a=r(8783);let c=["/","/square","/login","/register","/forgot-password","/change-password","/personalization","/about","/privacy"];function d(e){return c.some(t=>"/"===t?"/"===e:e.startsWith(t))}function u(e){let{children:t,fallback:r}=e,{isAuthenticated:c,authInfo:u}=(0,i.a)(),{t:f}=(0,l.Z)(),g=(0,o.useRouter)(),h=(0,o.usePathname)(),[m,p]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{let e=setTimeout(()=>{p(!0)},100);return()=>clearTimeout(e)},[]),(0,n.useEffect)(()=>{if(!m){console.log("AuthGuard: Waiting for initialization...");return}if(console.log("AuthGuard useEffect triggered:",{pathname:h,search:window.location.search,isAuthenticated:c,hasAuthInfo:!!u,isPublic:d(h),isInitialized:m}),d(h)){console.log("Public path, no auth check needed");return}if(c&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token))console.log("User is authenticated, allowing access");else{let e;if(console.log("User not authenticated, checking for redirect loop"),function(e,t){if(console.log("Checking for redirect loop:",{pathname:e,search:t}),e.startsWith("/login"))return console.log("Current path is login page, preventing redirect"),!0;let r=new URLSearchParams(t).get("redirect");if(r){console.log("Found redirect parameter:",r);try{let e=decodeURIComponent(r);if(console.log("Decoded redirect:",e),e.includes("/login"))return console.log("Redirect contains /login, preventing loop"),!0;if(e.includes("redirect="))return console.log("Redirect contains nested redirect parameter, preventing loop"),!0;if(e.includes("?"))return console.log("Redirect contains query parameters, preventing loop"),!0;if(e.includes("%2Flogin")||e.includes("%252Flogin"))return console.log("Redirect contains encoded login path, preventing loop"),!0}catch(e){return console.warn("Failed to decode redirect parameter:",r,e),!0}}return console.log("No redirect loop detected"),!1}(h,window.location.search)){console.warn("Prevented redirect loop to login page");return}if("/login"===h){console.warn("Already on login page, preventing redirect");return}window.location.search.includes("redirect=")?(e="/login",console.log("Existing redirect detected, using default login URL")):console.log("Redirecting to login:",e="/login?redirect=".concat(encodeURIComponent(h))),g.push(e)}},[c,u,h,g,m]),d(h))?(0,s.jsx)(s.Fragment,{children:t}):c&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token)?(0,s.jsx)(s.Fragment,{children:t}):r||(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)(a.TK,{size:"lg",text:f("common.verifying")})})})}},8783:function(e,t,r){"use strict";r.d(t,{TK:function(){return a},Te:function(){return c},ub:function(){return d}});var s=r(7437),n=r(2869),o=r(9322),i=r(7168),l=r(759);function a(e){let{size:t="md",text:r,className:n=""}=e,{t:o}=(0,l.Z)(),i=r||o("common.loading");return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(n),children:[(0,s.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-[#11295b] ".concat({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t]," mb-2")}),i&&(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:i})]})}function c(e){let{error:t,onRetry:r,retryText:a,className:c=""}=e,{t:d}=(0,l.Z)(),u=a||d("common.retry");return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(c),children:[(0,s.jsx)(o.Z,{className:"h-8 w-8 text-red-500 mb-2"}),(0,s.jsx)("p",{className:"text-red-500 mb-4 text-center",children:t}),r&&(0,s.jsxs)(n.z,{onClick:r,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),u]})]})}function d(e){let{title:t,description:r,icon:n,action:o,className:i=""}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center ".concat(i),children:[n&&(0,s.jsx)("div",{className:"mb-4",children:n}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),r&&(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:r}),o&&(0,s.jsx)("div",{children:o})]})}},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var s=r(2265);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),i=e=>{let t=o(e);return t.charAt(0).toUpperCase()+t.slice(1)},l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},a=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:d="",children:u,iconNode:f,...g}=e;return(0,s.createElement)("svg",{ref:t,...c,width:n,height:n,stroke:r,strokeWidth:i?24*Number(o)/Number(n):o,className:l("lucide",d),...!u&&!a(g)&&{"aria-hidden":"true"},...g},[...f.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),u=(e,t)=>{let r=(0,s.forwardRef)((r,o)=>{let{className:a,...c}=r;return(0,s.createElement)(d,{ref:o,iconNode:t,className:l("lucide-".concat(n(i(e))),"lucide-".concat(e),a),...c})});return r.displayName=i(e),r}},2451:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9322:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6337:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},9345:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},7168:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},function(e){e.O(0,[604,51,624,971,117,744],function(){return e(e.s=909)}),_N_E=e.O()}]);