(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{5810:function(e,t,a){Promise.resolve().then(a.bind(a,6245))},6245:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var r=a(7437),s=a(2869),n=a(2451),l=a(2489),o=a(3581),i=a(3774),c=a(759),d=a(6281),u=a(9512),g=a(8444),f=a(2690),h=a(3145),x=a(9376),m=a(2265),p=a(6023);function y(){let{t:e,language:t}=(0,c.Z)(),{authInfo:a,isAuthenticated:y}=(0,d.a)(),b=(0,x.useRouter)(),[v,j]=(0,m.useState)(!1),[w,N]=(0,m.useState)([]),[k,P]=(0,m.useState)([]),[C,E]=(0,m.useState)(null),[S,Z]=(0,m.useState)(null),[I,R]=(0,m.useState)(""),[U,L]=(0,m.useState)(""),[F,z]=(0,m.useState)(""),[A,T]=(0,m.useState)(""),[M,O]=(0,m.useState)(null),[q,_]=(0,m.useState)(!0),[D,V]=(0,m.useState)(!1),[H,W]=(0,m.useState)(""),[B,G]=(0,m.useState)(""),[$,K]=(0,m.useState)(""),[J,Q]=(0,m.useState)(!1),X=(0,m.useCallback)(()=>{if(!navigator.geolocation){W(e("releasePage.locationError"));return}Q(!0),W(""),navigator.geolocation.getCurrentPosition(async a=>{try{let{latitude:e,longitude:r}=a.coords,s="en"===t?"en":"zh",n=await fetch("https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(e,"&longitude=").concat(r,"&localityLanguage=").concat(s));if(n.ok){let e;let t=await n.json();e="en"===s?"".concat(t.countryName||"",", ").concat(t.city||t.locality||""):"".concat(t.countryName||"","ï¼Œ").concat(t.city||t.locality||""),K(e)}else K("".concat(e.toFixed(4),", ").concat(r.toFixed(4)))}catch(t){console.error("Failed to get address info:",t),K(e("releasePage.locationParseError"))}finally{Q(!1)}},t=>{console.error("Failed to get location:",t);let a=e("releasePage.locationFailed");switch(t.code){case t.PERMISSION_DENIED:a=e("releasePage.locationPermissionDenied");break;case t.POSITION_UNAVAILABLE:a=e("releasePage.locationUnavailable");break;case t.TIMEOUT:a=e("releasePage.locationTimeout")}W(a),Q(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},[t]);(0,m.useEffect)(()=>{X()},[X]),(0,m.useEffect)(()=>()=>{S&&URL.revokeObjectURL(S)},[S]);let Y=(0,m.useCallback)(async()=>{if(!a){W(e("releasePage.authInfoMissing"));return}try{let e=await (0,p.bG)({email:a.email,userId:a.userId,token:a.token});if(e.success&&e.data){let t=e.data;O(t),t.brand&&z(t.brand),t.brief&&T(t.brief)}}catch(t){console.error("Failed to get user info:",t),W(e("releasePage.getUserInfoFailed"))}},[a]),ee=(0,m.useCallback)(()=>!!I.trim()||(W(e("releasePage.titleRequired")),!1),[I,e]),et=e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];P([...k,t]);let a=new FileReader;a.onloadend=()=>{N([...w,a.result])},a.readAsDataURL(t)}},ea=t=>{if(t.target.files&&t.target.files[0]){let a=t.target.files[0];if(C){W(e("releasePage.onlyOneVideoAllowed"));return}E(a),Z(URL.createObjectURL(a))}},er=e=>{N(w.filter((t,a)=>a!==e)),P(k.filter((t,a)=>a!==e))},es=async t=>{t.preventDefault(),V(!0),W(""),G("");try{if(!ee()){V(!1);return}let t=[],n="";if(k.length>0)for(let a of(G(e("releasePage.uploadingImages")),k))try{let e=await (0,p.gg)(a);if(e.success&&e.data){let a="string"==typeof e.data?e.data:e.data.img;a&&t.push(a)}}catch(t){console.error("Image upload failed:",t),W("".concat(e("releasePage.imageUploadError"),": ").concat(t instanceof Error?t.message:e("releasePage.unknownError"))),G(""),V(!1);return}if(C){G(e("releasePage.uploadingVideo"));try{var r,s;let e=await (0,p.$x)(C);if(e.success&&(null===(r=e.data)||void 0===r?void 0:r.code)===0)n=e.data.url;else throw Error((null===(s=e.data)||void 0===s?void 0:s.msg)||"Video upload failed")}catch(t){console.error("Video upload failed:",t),W("".concat(e("releasePage.videoUploadError"),": ").concat(t instanceof Error?t.message:e("releasePage.unknownError"))),G(""),V(!1);return}}let l={userId:a.userId,token:a.token,title:I.trim(),description:U.trim(),location:$||e("releasePage.gettingLocation"),images:t.join(","),video:n?"/"+n:"",intro:v?(null==M?void 0:M.brief)||A:"",website:v&&(null==M?void 0:M.officialsite)||"",logo:v&&(null==M?void 0:M.logo)||"",customerService:v&&(null==M?void 0:M.tel)||"",workingHours:v&&(null==M?void 0:M.address)||""};G(e("releasePage.publishingContent"));let o=await (0,p.h5)(l);o.success?(G(e("releasePage.publishSuccess")),setTimeout(()=>{b.push("/personal")},2e3)):(W(o.message||e("releasePage.publishError")),G(""))}catch(t){W(t instanceof Error?t.message:e("releasePage.publishProcessError")),G("")}finally{V(!1)}};return(0,r.jsx)(f.a,{children:(0,r.jsxs)("main",{className:"container-page flex min-h-dvh flex-col bg-white",children:[(0,r.jsx)(u.h,{showLanguage:!0,showSearch:!0,showUser:!0}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-4",children:[(0,r.jsx)("h1",{className:"text-xl text-[#11295b] font-poppins",children:e("releasePage.title")}),(0,r.jsx)("button",{onClick:()=>{b.back()},className:"text-[#11295b] hover:text-[#11295b]",children:(0,r.jsx)(n.Z,{className:"h-7 w-7"})})]}),(0,r.jsxs)("form",{onSubmit:es,className:"flex-1 px-6 space-y-6",children:[(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",placeholder:e("releasePage.fieldTitle"),value:I,onChange:e=>R(e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60",required:!0})}),(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{placeholder:e("releasePage.fieldContent"),value:U,onChange:e=>L(e.target.value),rows:6,className:"w-full rounded-lg bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[w.map((e,t)=>(0,r.jsxs)("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-300",children:[(0,r.jsx)(h.default,{src:e,alt:"Uploaded",layout:"fill",objectFit:"cover"}),(0,r.jsx)("button",{type:"button",onClick:()=>er(t),className:"absolute top-1 right-1 bg-black bg-opacity-50 text-white rounded-full p-1 hover:bg-opacity-70",children:(0,r.jsx)(l.Z,{className:"h-3 w-3"})})]},"image-".concat(t))),C&&S&&(0,r.jsxs)("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-300 bg-gray-100",children:[(0,r.jsx)("video",{src:S,className:"w-full h-full object-cover",muted:!0,preload:"metadata",onLoadedMetadata:e=>{e.currentTarget.currentTime=.1}}),(0,r.jsx)("button",{type:"button",onClick:()=>{S&&URL.revokeObjectURL(S),E(null),Z(null)},className:"absolute top-1 right-1 bg-black bg-opacity-50 text-white rounded-full p-1 hover:bg-opacity-70",children:(0,r.jsx)(l.Z,{className:"h-3 w-3"})})]}),w.length+(C?1:0)<8&&(0,r.jsxs)("label",{className:"aspect-square flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300 cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,r.jsx)("input",{type:"file",accept:C?"image/*":"image/*,video/*",className:"hidden",onChange:t=>{var a;let r=null===(a=t.target.files)||void 0===a?void 0:a[0];if(r){if(r.type.startsWith("image/"))et(t);else if(r.type.startsWith("video/")){if(C){W(e("releasePage.onlyOneVideoAllowed")),t.target.value="";return}ea(t)}t.target.value=""}}}),(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)(o.Z,{className:"h-6 w-6 text-gray-400 mb-1"}),(0,r.jsx)("span",{className:"text-xs text-gray-500 text-center",children:C?e("releasePage.addImage"):e("releasePage.addMedia")})]})]})]}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[w.length+(C?1:0),"/8 ",e("releasePage.mediaFiles")]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:[e("releasePage.location"),": ",$||e("releasePage.gettingLocation")]})]}),!$&&!J&&(0,r.jsx)("button",{type:"button",onClick:X,className:"text-sm text-blue-500 hover:text-blue-700",children:e("releasePage.retryLocation")})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("h2",{className:"text-lg text-[#11295b] font-poppins",children:e("releasePage.advantageInfo")}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:v,onChange:async e=>{let t=e.target.checked;j(t),t?await Y():(z(""),T(""),O(null))},className:"form-checkbox h-4 w-4 rounded-sm border-gray-400 text-[#11295b] focus:ring-[#11295b]"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:e("releasePage.fillBrandInfo")})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",placeholder:e("releasePage.brandProductionName"),value:F,onChange:e=>z(e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{placeholder:e("releasePage.briefDescription"),value:A,onChange:e=>T(e.target.value),rows:4,className:"w-full rounded-lg bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})})]})]}),H&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-500 text-sm",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"}),(0,r.jsx)("span",{children:H})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:q,onChange:e=>_(e.target.checked),className:"form-checkbox h-4 w-4 rounded-sm border-gray-400 ".concat(q?"bg-[#11295b] text-white border-[#11295b]":"bg-gray-200 text-[#11295b] border-gray-400"," focus:ring-[#11295b] transition-colors")}),(0,r.jsx)("span",{className:"text-gray-700 text-sm",children:e("releasePage.allowingComments")})]}),(0,r.jsx)(s.z,{type:"submit",className:"w-full bg-[#11295b] text-white shadow-md rounded-lg",size:"lg",disabled:D||!!B&&!H,children:D?e("releasePage.publishing"):B&&!H?e("releasePage.publishSuccess"):e("releasePage.releaseButton")})]}),(0,r.jsx)(g.$,{})]})})}},2690:function(e,t,a){"use strict";a.d(t,{a:function(){return u}});var r=a(7437),s=a(2265),n=a(9376),l=a(6281),o=a(759),i=a(8783);let c=["/","/square","/login","/register","/forgot-password","/change-password","/personalization","/about","/privacy"];function d(e){return c.some(t=>"/"===t?"/"===e:e.startsWith(t))}function u(e){let{children:t,fallback:a}=e,{isAuthenticated:c,authInfo:u}=(0,l.a)(),{t:g}=(0,o.Z)(),f=(0,n.useRouter)(),h=(0,n.usePathname)(),[x,m]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{let e=setTimeout(()=>{m(!0)},100);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{if(!x){console.log("AuthGuard: Waiting for initialization...");return}if(console.log("AuthGuard useEffect triggered:",{pathname:h,search:window.location.search,isAuthenticated:c,hasAuthInfo:!!u,isPublic:d(h),isInitialized:x}),d(h)){console.log("Public path, no auth check needed");return}if(c&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token))console.log("User is authenticated, allowing access");else{let e;if(console.log("User not authenticated, checking for redirect loop"),function(e,t){if(console.log("Checking for redirect loop:",{pathname:e,search:t}),e.startsWith("/login"))return console.log("Current path is login page, preventing redirect"),!0;let a=new URLSearchParams(t).get("redirect");if(a){console.log("Found redirect parameter:",a);try{let e=decodeURIComponent(a);if(console.log("Decoded redirect:",e),e.includes("/login"))return console.log("Redirect contains /login, preventing loop"),!0;if(e.includes("redirect="))return console.log("Redirect contains nested redirect parameter, preventing loop"),!0;if(e.includes("?"))return console.log("Redirect contains query parameters, preventing loop"),!0;if(e.includes("%2Flogin")||e.includes("%252Flogin"))return console.log("Redirect contains encoded login path, preventing loop"),!0}catch(e){return console.warn("Failed to decode redirect parameter:",a,e),!0}}return console.log("No redirect loop detected"),!1}(h,window.location.search)){console.warn("Prevented redirect loop to login page");return}if("/login"===h){console.warn("Already on login page, preventing redirect");return}window.location.search.includes("redirect=")?(e="/login",console.log("Existing redirect detected, using default login URL")):console.log("Redirecting to login:",e="/login?redirect=".concat(encodeURIComponent(h))),f.push(e)}},[c,u,h,f,x]),d(h))?(0,r.jsx)(r.Fragment,{children:t}):c&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token)?(0,r.jsx)(r.Fragment,{children:t}):a||(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)(i.TK,{size:"lg",text:g("common.verifying")})})})}},8444:function(e,t,a){"use strict";a.d(t,{$:function(){return c}});var r=a(7437),s=a(759),n=a(2869),l=a(4508);function o(){let{language:e,setLanguage:t,t:a}=(0,s.Z)();return(0,r.jsxs)("div",{className:"flex items-center gap-2 mr-1",children:[(0,r.jsx)(n.z,{variant:"ghost",size:"sm",className:(0,l.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:a("footer.language.en")}),(0,r.jsx)(n.z,{variant:"ghost",size:"sm",className:(0,l.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:a("footer.language.zh")})]})}var i=a(7648);function c(){let{t:e}=(0,s.Z)();return(0,r.jsx)("footer",{className:"mt-auto text-[11px] text-muted-foreground py-2 px-2 w-full font-inter",children:(0,r.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 font-inter",children:(0,r.jsx)(o,{})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,r.jsx)(i.default,{href:"/about",className:"text-muted-foreground font-inter",children:e("footer.links.about")}),(0,r.jsx)(i.default,{href:"/privacy",className:"text-muted-foreground font-inter",children:e("footer.links.privacy")}),(0,r.jsx)("span",{className:"text-muted-foreground font-inter",children:e("footer.copyright")})]})]})})}},8783:function(e,t,a){"use strict";a.d(t,{TK:function(){return i},Te:function(){return c},ub:function(){return d}});var r=a(7437),s=a(2869),n=a(9322),l=a(7168),o=a(759);function i(e){let{size:t="md",text:a,className:s=""}=e,{t:n}=(0,o.Z)(),l=a||n("common.loading");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(s),children:[(0,r.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-[#11295b] ".concat({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t]," mb-2")}),l&&(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:l})]})}function c(e){let{error:t,onRetry:a,retryText:i,className:c=""}=e,{t:d}=(0,o.Z)(),u=i||d("common.retry");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(c),children:[(0,r.jsx)(n.Z,{className:"h-8 w-8 text-red-500 mb-2"}),(0,r.jsx)("p",{className:"text-red-500 mb-4 text-center",children:t}),a&&(0,r.jsxs)(s.z,{onClick:a,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),u]})]})}function d(e){let{title:t,description:a,icon:s,action:n,className:l=""}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center text-center ".concat(l),children:[s&&(0,r.jsx)("div",{className:"mb-4",children:s}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),a&&(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:a}),n&&(0,r.jsx)("div",{children:n})]})}},3581:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},2451:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9322:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},3774:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},7168:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},2489:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[516,51,282,971,117,744],function(){return e(e.s=5810)}),_N_E=e.O()}]);