(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{5810:function(e,a,t){Promise.resolve().then(t.bind(t,6245))},6245:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return b}});var s=t(7437),r=t(2869),l=t(2451),n=t(2489),o=t(3581),i=t(3774),c=t(759),d=t(6281),u=t(4196),g=t(1839),h=t(2690),x=t(3145),f=t(9376),m=t(2265),p=t(6023);function b(){let{t:e,language:a}=(0,c.Z)(),{authInfo:t,isAuthenticated:b}=(0,d.a)(),y=(0,f.useRouter)(),[v,j]=(0,m.useState)(!1),[w,N]=(0,m.useState)([]),[P,k]=(0,m.useState)([]),[S,C]=(0,m.useState)(null),[E,L]=(0,m.useState)(null),[I,F]=(0,m.useState)(""),[U,B]=(0,m.useState)(""),[O,R]=(0,m.useState)(""),[A,M]=(0,m.useState)(""),[T,Z]=(0,m.useState)(null),[_,D]=(0,m.useState)(!0),[V,q]=(0,m.useState)(!1),[z,W]=(0,m.useState)(""),[H,$]=(0,m.useState)(""),[G,J]=(0,m.useState)(""),[K,Q]=(0,m.useState)(!1),X=(0,m.useCallback)(()=>{if(!navigator.geolocation){W(e("releasePage.locationError"));return}Q(!0),W(""),navigator.geolocation.getCurrentPosition(async t=>{try{let{latitude:e,longitude:s}=t.coords,r="en"===a?"en":"zh",l=await fetch("https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(e,"&longitude=").concat(s,"&localityLanguage=").concat(r));if(l.ok){let e;let a=await l.json();e="en"===r?"".concat(a.countryName||"",", ").concat(a.city||a.locality||""):"".concat(a.countryName||"","ï¼Œ").concat(a.city||a.locality||""),J(e)}else J("".concat(e.toFixed(4),", ").concat(s.toFixed(4)))}catch(a){console.error("Failed to get address info:",a),J(e("releasePage.locationParseError"))}finally{Q(!1)}},a=>{console.error("Failed to get location:",a);let t=e("releasePage.locationFailed");switch(a.code){case a.PERMISSION_DENIED:t=e("releasePage.locationPermissionDenied");break;case a.POSITION_UNAVAILABLE:t=e("releasePage.locationUnavailable");break;case a.TIMEOUT:t=e("releasePage.locationTimeout")}W(t),Q(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},[a]);(0,m.useEffect)(()=>{X()},[X]),(0,m.useEffect)(()=>()=>{E&&URL.revokeObjectURL(E)},[E]);let Y=(0,m.useCallback)(async()=>{if(!t){W(e("releasePage.authInfoMissing"));return}try{let e=await (0,p.bG)({email:t.email,userId:t.userId,token:t.token});if(e.success&&e.data){let a=e.data;Z(a),a.brand&&R(a.brand),a.brief&&M(a.brief)}}catch(a){console.error("Failed to get user info:",a),W(e("releasePage.getUserInfoFailed"))}},[t]),ee=(0,m.useCallback)(()=>!!I.trim()||(W(e("releasePage.titleRequired")),!1),[I,e]),ea=e=>{if(e.target.files&&e.target.files[0]){let a=e.target.files[0];k([...P,a]);let t=new FileReader;t.onloadend=()=>{N([...w,t.result])},t.readAsDataURL(a)}},et=a=>{if(a.target.files&&a.target.files[0]){let t=a.target.files[0];if(S){W(e("releasePage.onlyOneVideoAllowed"));return}C(t),L(URL.createObjectURL(t))}},es=e=>{N(w.filter((a,t)=>t!==e)),k(P.filter((a,t)=>t!==e))},er=async a=>{a.preventDefault(),q(!0),W(""),$("");try{if(!ee()){q(!1);return}let a=[],l="";if(P.length>0)for(let t of($(e("releasePage.uploadingImages")),P))try{let e=await (0,p.gg)(t);if(e.success&&e.data){let t="string"==typeof e.data?e.data:e.data.img;t&&a.push(t)}}catch(a){console.error("Image upload failed:",a),W("".concat(e("releasePage.imageUploadError"),": ").concat(a instanceof Error?a.message:e("releasePage.unknownError"))),$(""),q(!1);return}if(S){$(e("releasePage.uploadingVideo"));try{var s,r;let e=await (0,p.$x)(S);if(e.success&&(null===(s=e.data)||void 0===s?void 0:s.code)===0)l=e.data.url;else throw Error((null===(r=e.data)||void 0===r?void 0:r.msg)||"Video upload failed")}catch(a){console.error("Video upload failed:",a),W("".concat(e("releasePage.videoUploadError"),": ").concat(a instanceof Error?a.message:e("releasePage.unknownError"))),$(""),q(!1);return}}let n={userId:t.userId,token:t.token,title:I.trim(),description:U.trim(),location:G||e("releasePage.gettingLocation"),images:a.join(","),video:l?"/"+l:"",intro:v?(null==T?void 0:T.brief)||A:"",website:v&&(null==T?void 0:T.officialsite)||"",logo:v&&(null==T?void 0:T.logo)||"",customerService:v&&(null==T?void 0:T.tel)||"",workingHours:v&&(null==T?void 0:T.address)||""};$(e("releasePage.publishingContent"));let o=await (0,p.h5)(n);o.success?($(e("releasePage.publishSuccess")),setTimeout(()=>{y.push("/personal")},2e3)):(W(o.message||e("releasePage.publishError")),$(""))}catch(a){W(a instanceof Error?a.message:e("releasePage.publishProcessError")),$("")}finally{q(!1)}};return(0,s.jsx)(h.a,{children:(0,s.jsxs)("main",{className:" flex min-h-dvh flex-col bg-white",children:[(0,s.jsx)(u.h,{showSearch:!0,showUser:!0}),(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 z-100",children:[(0,s.jsx)("h1",{className:"text-xl font-poppins text-[#0F1728] font-semibold",children:e("releasePage.title")}),(0,s.jsx)("button",{onClick:()=>{y.back()},className:"text-[#0F1728] hover:text-[#0F1728]",children:(0,s.jsx)(l.Z,{className:"h-7 w-7  z-10"})})]}),(0,s.jsxs)("form",{onSubmit:er,className:"flex-1 px-6 space-y-6",children:[(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"text",placeholder:e("releasePage.fieldTitle"),value:I,onChange:e=>F(e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60",required:!0})}),(0,s.jsx)("div",{children:(0,s.jsx)("textarea",{placeholder:e("releasePage.fieldContent"),value:U,onChange:e=>B(e.target.value),rows:6,className:"w-full rounded-lg bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[w.map((e,a)=>(0,s.jsxs)("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-300",children:[(0,s.jsx)(x.default,{src:e,alt:"Uploaded",layout:"fill",objectFit:"cover"}),(0,s.jsx)("button",{type:"button",onClick:()=>es(a),className:"absolute top-1 right-1 bg-black bg-opacity-50 text-white rounded-full p-1 hover:bg-opacity-70",children:(0,s.jsx)(n.Z,{className:"h-3 w-3"})})]},"image-".concat(a))),S&&E&&(0,s.jsxs)("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-300 bg-gray-100",children:[(0,s.jsx)("video",{src:E,className:"w-full h-full object-cover",muted:!0,preload:"metadata",onLoadedMetadata:e=>{e.currentTarget.currentTime=.1}}),(0,s.jsx)("button",{type:"button",onClick:()=>{E&&URL.revokeObjectURL(E),C(null),L(null)},className:"absolute top-1 right-1 bg-black bg-opacity-50 text-white rounded-full p-1 hover:bg-opacity-70",children:(0,s.jsx)(n.Z,{className:"h-3 w-3"})})]}),w.length+(S?1:0)<8&&(0,s.jsxs)("label",{className:"aspect-square flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300 cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,s.jsx)("input",{type:"file",accept:S?"image/*":"image/*,video/*",className:"hidden",onChange:a=>{var t;let s=null===(t=a.target.files)||void 0===t?void 0:t[0];if(s){if(s.type.startsWith("image/"))ea(a);else if(s.type.startsWith("video/")){if(S){W(e("releasePage.onlyOneVideoAllowed")),a.target.value="";return}et(a)}a.target.value=""}}}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(o.Z,{className:"h-6 w-6 text-gray-400 mb-1"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 text-center",children:S?e("releasePage.addImage"):e("releasePage.addMedia")})]})]})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[w.length+(S?1:0),"/8 ",e("releasePage.mediaFiles")]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4 text-[#0F1728] font-semibold"}),(0,s.jsx)("span",{children:G||e("releasePage.gettingLocation")})]}),!G&&!K&&(0,s.jsx)("button",{type:"button",onClick:X,className:"text-sm text-blue-500 hover:text-blue-700",children:e("releasePage.retryLocation")})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h2",{className:"text-xl font-inter text-[#0F1728] font-semibold",children:e("releasePage.advantageInfo")}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("label",{className:"relative h-4 w-4 flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:v,onChange:async e=>{let a=e.target.checked;j(a),a?await Y():(R(""),M(""),Z(null))},className:"peer h-4 w-4 appearance-none border-1 rounded border-[#12295B] bg-white text-primary focus:ring-primary/60 checked:border-[#12295B] outline-none"}),(0,s.jsx)("span",{className:"pointer-events-none absolute left-0 top-0 h-4 w-4 flex items-center justify-center "+(v?"":"hidden"),children:(0,s.jsx)("svg",{className:"h-3 w-3 text-[#12295B]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),(0,s.jsx)("span",{className:"text-xs font-inter text-[#0F1728]",children:e("releasePage.fillBrandInfo")})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"text",placeholder:e("releasePage.brandProductionName"),value:O,onChange:e=>R(e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,s.jsx)("div",{children:(0,s.jsx)("textarea",{placeholder:e("releasePage.briefDescription"),value:A,onChange:e=>M(e.target.value),rows:4,className:"w-full rounded-lg bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})})]})]}),z&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-red-500 text-sm",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"}),(0,s.jsx)("span",{children:z})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("label",{className:"relative h-4 w-4 flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:_,onChange:e=>D(e.target.checked),className:"peer h-4 w-4 appearance-none border-1 rounded border-[#12295B] bg-white text-primary focus:ring-primary/60 checked:border-[#12295B] outline-none"}),(0,s.jsx)("span",{className:"pointer-events-none absolute left-0 top-0 h-4 w-4 flex items-center justify-center "+(_?"":"hidden"),children:(0,s.jsx)("svg",{className:"h-3 w-3 text-[#12295B]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),(0,s.jsx)("span",{className:"text-gray-700 text-sm",children:e("releasePage.allowingComments")})]}),(0,s.jsx)(r.z,{type:"submit",className:"w-full bg-[#11295b] text-white text-[17px] font-poppins font-semibold shadow-md rounded-lg",size:"lg",disabled:V||!!H&&!z,children:V?e("releasePage.publishing"):H&&!z?e("releasePage.publishSuccess"):e("releasePage.releaseButton")})]}),(0,s.jsx)(g.$,{})]})})}},2489:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(9205).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[604,51,624,951,971,117,744],function(){return e(e.s=5810)}),_N_E=e.O()}]);