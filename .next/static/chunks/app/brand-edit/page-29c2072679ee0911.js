(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[560],{9972:function(e,a,t){Promise.resolve().then(t.bind(t,3924))},3924:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return b}});var r=t(7437),l=t(2869),i=t(2451),n=t(3581),s=t(3774),o=t(759),d=t(4196),c=t(1839),u=t(9376),g=t(2265),f=t(6281),x=t(2690),m=t(6023),h=t(4512),p=t(9116);function b(){let{t:e}=(0,o.Z)(),a=(0,u.useRouter)(),{getEmail:t}=(0,f.a)(),{userParams:b}=(0,f.z)(),[y,v]=(0,g.useState)({brand:"",brief:"",logo:"",officialsite:"",tel:"",address:"",location:"",workHour:"",email:"",shopurl:""}),[j,w]=(0,g.useState)(!1),[E,N]=(0,g.useState)(null),[P,k]=(0,g.useState)(!1),[S,I]=(0,g.useState)(null),[C,F]=(0,g.useState)(""),[H,L]=(0,g.useState)(!1),[_,U]=(0,g.useState)(!0),[A,R]=(0,g.useState)(!1),z=(0,g.useRef)(null),O=(0,g.useRef)(!1);(0,g.useEffect)(()=>{(async()=>{if(O.current)return;let a=t();if(!a||!b){U(!1);return}O.current=!0;try{let e=await (0,m.bG)({email:a,userId:b.userId,token:b.token});if(e.success&&e.data){let a=e.data;v({brand:a.brand||"",brief:a.brief||"",logo:a.logo||"",officialsite:a.officialsite||"",tel:a.tel||"",address:a.address||"",location:a.location||"",workHour:a.workHour||"",email:a.email||"",shopurl:a.shopurl||""}),a.logo&&F((0,p.nJ)(a.logo))}}catch(a){console.error("获取用户信息失败:",a),N(e("brandEditPage.getUserInfoFailed"))}finally{U(!1)}})()},[null==b?void 0:b.userId,null==b?void 0:b.token]);let T=(0,g.useCallback)(async()=>{R(!0),N(null);try{let e=await (0,h.g_)({enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5});v(a=>({...a,location:e}))}catch(t){console.error("获取位置失败:",t);let a=e("brandEditPage.locationFailed");if(t&&"object"==typeof t&&"code"in t)switch(t.code){case 1:a=e("brandEditPage.locationPermissionDenied");break;case 2:a=e("brandEditPage.locationUnavailable");break;case 3:a=e("brandEditPage.locationTimeout");break;case -1:a=e("brandEditPage.locationError")}N(a)}finally{R(!1)}},[e]),D=(e,a)=>{v(t=>({...t,[e]:a}))},Z=async a=>{var t;let r=null===(t=a.target.files)||void 0===t?void 0:t[0];if(r){if(!r.type.startsWith("image/")){N(e("brandEditPage.invalidImageType"));return}if(r.size>10485760){N(e("brandEditPage.imageTooLarge"));return}I(r),L(!0),N(null);try{let a=new FileReader;a.onload=e=>{var a;F(null===(a=e.target)||void 0===a?void 0:a.result)},a.readAsDataURL(r);let t=await (0,m.gg)(r);if(t.success&&t.data){let a="string"==typeof t.data?t.data:t.data.img;if(a&&(a.startsWith("/err")||a.includes("error")))throw Error(e("brandEditPage.imageFormatNotSupported"));a&&(v(e=>({...e,logo:a})),F((0,p.nJ)(a)))}else throw Error(t.message||e("brandEditPage.logoUploadFailed"))}catch(a){console.error("Logo upload failed:",a),N(a instanceof Error?a.message:e("brandEditPage.logoUploadFailed")),I(null),F("")}finally{L(!1)}}},q=async()=>{if(!t()){N(e("brandEditPage.loginRequired")||"");return}if(!y.brand.trim()){N(e("brandEditPage.brandRequired")||"");return}w(!0),N(null);try{if(!b){N(e("brandEditPage.authInfoMissing")||"");return}let t=await (0,m.I)({userId:b.userId,token:b.token,brand:y.brand,brief:y.brief,logo:y.logo,officialsite:y.officialsite,tel:y.tel,address:y.address,location:y.location,workHour:y.workHour,email:y.email,shopurl:y.shopurl});t.success?(k(!0),setTimeout(()=>{a.push("/personal")},2e3)):N(t.message||e("brandEditPage.submitError")||"")}catch(a){N(a instanceof Error?a.message:e("brandEditPage.submitError")||"")}finally{w(!1)}};return(0,r.jsx)(x.a,{children:(0,r.jsxs)("main",{className:"flex min-h-dvh flex-col bg-white",children:[(0,r.jsx)(d.h,{}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 z-100",children:[(0,r.jsx)("h1",{className:"text-xl font-poppins text-[#0F1728] font-semibold",children:e("brandEditPage.title")}),(0,r.jsx)("button",{onClick:()=>a.push("/personal"),className:"text-[#0F1728] hover:text-[#0F1728]",children:(0,r.jsx)(i.Z,{className:"h-7 w-7 z-10"})})]}),_?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#11295b] mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:e("brandEditPage.loading")})]})}):(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),q()},className:"flex-1 px-6 py-4 space-y-6",children:[(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",placeholder:e("brandEditPage.brand"),value:y.brand,onChange:e=>D("brand",e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60",required:!0})}),(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{placeholder:e("brandEditPage.brief"),value:y.brief,onChange:e=>D("brief",e.target.value),rows:4,className:"w-full rounded-lg bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsxs)("div",{className:"flex flex-col items-start",children:[(0,r.jsxs)("label",{className:"w-20 h-20 flex flex-col items-center justify-center rounded-xl bg-gray-200 cursor-pointer relative overflow-hidden ".concat(H?"opacity-50 pointer-events-none":""),children:[(0,r.jsx)("input",{ref:z,type:"file",accept:"image/*",onChange:Z,className:"hidden",disabled:H}),C?(0,r.jsxs)("div",{className:"w-full h-full relative",children:[(0,r.jsx)("img",{src:C,alt:"Logo preview",className:"w-full h-full object-cover rounded-xl"}),H&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-white text-xs",children:e("brandEditPage.uploading")})})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)(n.Z,{className:"h-8 w-8 text-gray-400 mt-2"}),(0,r.jsx)("span",{className:"block mt-2 text-gray-500 text-sm font-normal",children:H?e("brandEditPage.uploading"):e("brandEditPage.logo")})]})]}),S&&!H&&y.logo&&(0,r.jsx)("div",{className:"mt-2 text-xs text-green-600",children:e("brandEditPage.logoUploaded")})]}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",placeholder:e("brandEditPage.officialSite"),value:y.officialsite,onChange:e=>D("officialsite",e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",placeholder:e("releasePage.shopUrl")||"Online shop",value:y.shopurl,onChange:e=>D("shopurl",e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"tel",placeholder:e("brandEditPage.telMobile"),value:y.tel,onChange:e=>D("tel",e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{placeholder:e("brandEditPage.workHour"),value:y.workHour,onChange:e=>D("workHour",e.target.value),rows:3,className:"w-full rounded-lg bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{placeholder:e("brandEditPage.email"),value:y.email,onChange:e=>D("email",e.target.value),rows:3,className:"w-full rounded-lg bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{placeholder:e("brandEditPage.address"),value:y.address,onChange:e=>D("address",e.target.value),rows:3,className:"w-full rounded-lg bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,r.jsx)(s.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:[e("brandEditPage.location"),": ",y.location||e("brandEditPage.gettingLocation")]})]}),!A&&!y.location&&(0,r.jsxs)("button",{type:"button",onClick:T,className:"text-sm text-blue-500 hover:text-blue-700 flex items-center gap-1",children:[(0,r.jsx)(s.Z,{className:"h-3 w-3"}),e("brandEditPage.getCurrentLocation")]}),A&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-sm text-blue-500",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-500"}),e("brandEditPage.gettingLocation")]})]}),E&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-500 text-sm",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"}),(0,r.jsx)("span",{children:E})]}),P&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-500 text-sm",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500"}),(0,r.jsx)("span",{children:e("brandEditPage.submitSuccess")})]}),(0,r.jsx)(l.z,{type:"submit",className:"w-full bg-[#11295b] text-white shadow-md rounded-lg",size:"lg",disabled:j||!!P,children:j?e("brandEditPage.submitting"):e("brandEditPage.submit")})]}),(0,r.jsx)("div",{className:"mt-auto",children:(0,r.jsx)(c.$,{})})]})})}},4512:function(e,a,t){"use strict";async function r(e,a){try{if("geolocation"in navigator&&"reverseGeocode"in navigator)throw Error("浏览器不支持反向地理编码");let t=await fetch("https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(e,"&longitude=").concat(a,"&localityLanguage=zh"));if(!t.ok)throw Error("地理编码服务不可用");let r=await t.json(),l=[];return r.locality&&l.push(r.locality),r.principalSubdivision&&l.push(r.principalSubdivision),r.countryName&&l.push(r.countryName),l.join("，")||"".concat(e.toFixed(4),", ").concat(a.toFixed(4))}catch(t){return"".concat(e.toFixed(4),", ").concat(a.toFixed(4))}}async function l(e){try{let a=await function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5};return new Promise((a,t)=>{if(!navigator.geolocation){t({code:-1,message:"浏览器不支持地理位置功能"});return}navigator.geolocation.getCurrentPosition(e=>{a({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy})},e=>{let a="获取地理位置失败";switch(e.code){case e.PERMISSION_DENIED:a="用户拒绝了地理位置请求";break;case e.POSITION_UNAVAILABLE:a="地理位置信息不可用";break;case e.TIMEOUT:a="获取地理位置超时";break;default:a="获取地理位置时发生未知错误"}t({code:e.code,message:a})},e)})}(e);return await r(a.latitude,a.longitude)}catch(e){return console.warn("获取地理位置失败，使用默认位置:",e),"中国，北京"}}async function i(){if(!navigator.permissions)return"prompt";try{return(await navigator.permissions.query({name:"geolocation"})).state}catch(e){return"prompt"}}t.d(a,{gI:function(){return i},g_:function(){return l}})}},function(e){e.O(0,[604,51,624,951,971,117,744],function(){return e(e.s=9972)}),_N_E=e.O()}]);