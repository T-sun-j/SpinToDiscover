(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[560],{9972:function(e,t,n){Promise.resolve().then(n.bind(n,3924))},3924:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var r=n(7437),a=n(2869),i=n(2451),o=n(3581),s=n(3774),l=n(759),c=n(9512),d=n(8444),u=n(9376),g=n(2265),f=n(6281),x=n(2690),m=n(6023),h=n(6652),p=n(8685),b=n(4512),y=n(9116);function v(){let{t:e}=(0,l.Z)(),t=(0,u.useRouter)(),{getEmail:n}=(0,f.a)(),{userParams:v}=(0,f.z)(),[j,N]=(0,g.useState)({brand:"",brief:"",logo:"",officialsite:"",tel:"",address:"",location:""}),[E,w]=(0,g.useState)(!1),[I,P]=(0,g.useState)(null),[_,A]=(0,g.useState)(!1),[S,R]=(0,g.useState)(null),[T,L]=(0,g.useState)(""),[k,C]=(0,g.useState)(!1),[M,O]=(0,g.useState)(!0),[U,F]=(0,g.useState)(!1),Z=(0,g.useRef)(null),D=(0,g.useRef)(!1);(0,g.useEffect)(()=>{(async()=>{if(D.current)return;let t=n();if(!t||!v){O(!1);return}D.current=!0;try{let e=await (0,m.bG)({email:t,userId:v.userId,token:v.token});if(e.success&&e.data){let t=e.data;N({brand:t.brand||"",brief:t.brief||"",logo:t.logo||"",officialsite:t.officialsite||"",tel:t.tel||"",address:t.address||"",location:t.location||"Istanbul"}),t.logo&&L((0,y.nJ)(t.logo))}}catch(t){console.error("获取用户信息失败:",t),P(e("brandEditPage.getUserInfoFailed"))}finally{O(!1)}})()},[null==v?void 0:v.userId,null==v?void 0:v.token]);let z=(0,g.useCallback)(async()=>{F(!0),P(null);try{let e=await (0,b.g_)({enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5});N(t=>({...t,location:e}))}catch(n){console.error("获取位置失败:",n);let t=e("brandEditPage.locationFailed");if(n&&"object"==typeof n&&"code"in n)switch(n.code){case 1:t=e("brandEditPage.locationPermissionDenied");break;case 2:t=e("brandEditPage.locationUnavailable");break;case 3:t=e("brandEditPage.locationTimeout");break;case -1:t=e("brandEditPage.locationError")}P(t)}finally{F(!1)}},[e]),G=(e,t)=>{N(n=>({...n,[e]:t}))},Y=async t=>{var n;let r=null===(n=t.target.files)||void 0===n?void 0:n[0];if(r){if(!r.type.startsWith("image/")){P(e("brandEditPage.invalidImageType"));return}if(r.size>10485760){P(e("brandEditPage.imageTooLarge"));return}R(r),C(!0),P(null);try{let t=new FileReader;t.onload=e=>{var t;L(null===(t=e.target)||void 0===t?void 0:t.result)},t.readAsDataURL(r);let n=await (0,m.gg)(r);if(n.success&&n.data){let e="string"==typeof n.data?n.data:n.data.img;e&&(N(t=>({...t,logo:e})),L((0,y.nJ)(e)))}else throw Error(n.message||e("brandEditPage.logoUploadFailed"))}catch(t){console.error("Logo upload failed:",t),P(t instanceof Error?t.message:e("brandEditPage.logoUploadFailed")),R(null),L("")}finally{C(!1)}}},B=async()=>{if(!n()){P(e("brandEditPage.loginRequired"));return}if(!j.brand.trim()){P(e("brandEditPage.brandRequired")||"品牌名称不能为空");return}w(!0),P(null);try{if(!v){P(e("brandEditPage.authInfoMissing"));return}let r=await (0,m.I)({email:n(),userId:v.userId,token:v.token,brand:j.brand,brief:j.brief,logo:j.logo,officialsite:j.officialsite,tel:j.tel,address:j.address,location:j.location});r.success?(A(!0),setTimeout(()=>{t.push("/personal")},2e3)):P(r.message||e("brandEditPage.submitError"))}catch(t){P(t instanceof Error?t.message:e("brandEditPage.submitError"))}finally{w(!1)}};return(0,r.jsx)(x.a,{children:(0,r.jsxs)("main",{className:"flex min-h-dvh flex-col bg-white",children:[(0,r.jsx)(c.h,{showLanguage:!0}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-4",children:[(0,r.jsx)("h1",{className:"text-xl text-[#11295b] font-poppins",children:e("brandEditPage.title")}),(0,r.jsx)("button",{onClick:()=>t.push("/personal"),className:"text-[#11295b] hover:text-[#11295b]",children:(0,r.jsx)(i.Z,{className:(0,h.AK)(p.vR.SIZES.ICON_LG,p.vR.COLORS.PRIMARY)})})]}),M?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#11295b] mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:e("brandEditPage.loading")})]})}):(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),B()},className:"flex-1 px-6 py-4 space-y-6",children:[(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",placeholder:e("brandEditPage.brand"),value:j.brand,onChange:e=>G("brand",e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60",required:!0})}),(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{placeholder:e("brandEditPage.brief"),value:j.brief,onChange:e=>G("brief",e.target.value),rows:4,className:"w-full rounded-lg bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsxs)("div",{className:"flex flex-col items-start",children:[(0,r.jsxs)("label",{className:"w-20 h-20 flex flex-col items-center justify-center rounded-xl bg-gray-200 cursor-pointer relative overflow-hidden ".concat(k?"opacity-50 pointer-events-none":""),children:[(0,r.jsx)("input",{ref:Z,type:"file",accept:"image/*",onChange:Y,className:"hidden",disabled:k}),T?(0,r.jsxs)("div",{className:"w-full h-full relative",children:[(0,r.jsx)("img",{src:T,alt:"Logo preview",className:"w-full h-full object-cover rounded-xl"}),k&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-white text-xs",children:"上传中..."})})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)(o.Z,{className:"h-8 w-8 text-gray-400 mt-2"}),(0,r.jsx)("span",{className:"block mt-2 text-gray-500 text-sm font-normal",children:k?e("brandEditPage.uploading"):e("brandEditPage.logo")})]})]}),S&&!k&&j.logo&&(0,r.jsx)("div",{className:"mt-2 text-xs text-green-600",children:e("brandEditPage.logoUploaded")})]}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"url",placeholder:e("brandEditPage.officialSite"),value:j.officialsite,onChange:e=>G("officialsite",e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"tel",placeholder:e("brandEditPage.telMobile"),value:j.tel,onChange:e=>G("tel",e.target.value),className:"w-full rounded-full bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{placeholder:e("brandEditPage.address"),value:j.address,onChange:e=>G("address",e.target.value),rows:3,className:"w-full rounded-lg bg-gray-200 px-4 py-3 text-gray-900 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/60"})}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,r.jsx)(s.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:[e("brandEditPage.location"),": ",j.location||e("brandEditPage.gettingLocation")]})]}),!U&&!j.location&&(0,r.jsxs)("button",{type:"button",onClick:z,className:"text-sm text-blue-500 hover:text-blue-700 flex items-center gap-1",children:[(0,r.jsx)(s.Z,{className:"h-3 w-3"}),e("brandEditPage.getCurrentLocation")]}),U&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-sm text-blue-500",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-500"}),e("brandEditPage.gettingLocation")]})]}),I&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-500 text-sm",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"}),(0,r.jsx)("span",{children:I})]}),_&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-500 text-sm",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500"}),(0,r.jsx)("span",{children:e("brandEditPage.submitSuccess")})]}),(0,r.jsx)(a.z,{type:"submit",className:"w-full bg-[#11295b] text-white shadow-md rounded-lg",size:"lg",disabled:E||!!_,children:E?e("brandEditPage.submitting"):e("brandEditPage.submit")})]}),(0,r.jsx)("div",{className:"mt-auto",children:(0,r.jsx)(d.$,{})})]})})}},2690:function(e,t,n){"use strict";n.d(t,{a:function(){return u}});var r=n(7437),a=n(2265),i=n(9376),o=n(6281),s=n(759),l=n(8783);let c=["/","/square","/login","/register","/forgot-password","/change-password","/personalization","/about","/privacy"];function d(e){return c.some(t=>"/"===t?"/"===e:e.startsWith(t))}function u(e){let{children:t,fallback:n}=e,{isAuthenticated:c,authInfo:u}=(0,o.a)(),{t:g}=(0,s.Z)(),f=(0,i.useRouter)(),x=(0,i.usePathname)(),[m,h]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let e=setTimeout(()=>{h(!0)},100);return()=>clearTimeout(e)},[]),(0,a.useEffect)(()=>{if(!m){console.log("AuthGuard: Waiting for initialization...");return}if(console.log("AuthGuard useEffect triggered:",{pathname:x,search:window.location.search,isAuthenticated:c,hasAuthInfo:!!u,isPublic:d(x),isInitialized:m}),d(x)){console.log("Public path, no auth check needed");return}if(c&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token))console.log("User is authenticated, allowing access");else{let e;if(console.log("User not authenticated, checking for redirect loop"),function(e,t){if(console.log("Checking for redirect loop:",{pathname:e,search:t}),e.startsWith("/login"))return console.log("Current path is login page, preventing redirect"),!0;let n=new URLSearchParams(t).get("redirect");if(n){console.log("Found redirect parameter:",n);try{let e=decodeURIComponent(n);if(console.log("Decoded redirect:",e),e.includes("/login"))return console.log("Redirect contains /login, preventing loop"),!0;if(e.includes("redirect="))return console.log("Redirect contains nested redirect parameter, preventing loop"),!0;if(e.includes("?"))return console.log("Redirect contains query parameters, preventing loop"),!0;if(e.includes("%2Flogin")||e.includes("%252Flogin"))return console.log("Redirect contains encoded login path, preventing loop"),!0}catch(e){return console.warn("Failed to decode redirect parameter:",n,e),!0}}return console.log("No redirect loop detected"),!1}(x,window.location.search)){console.warn("Prevented redirect loop to login page");return}if("/login"===x){console.warn("Already on login page, preventing redirect");return}window.location.search.includes("redirect=")?(e="/login",console.log("Existing redirect detected, using default login URL")):console.log("Redirecting to login:",e="/login?redirect=".concat(encodeURIComponent(x))),f.push(e)}},[c,u,x,f,m]),d(x))?(0,r.jsx)(r.Fragment,{children:t}):c&&(null==u?void 0:u.userId)&&(null==u?void 0:u.token)?(0,r.jsx)(r.Fragment,{children:t}):n||(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)(l.TK,{size:"lg",text:g("common.verifying")})})})}},8444:function(e,t,n){"use strict";n.d(t,{$:function(){return c}});var r=n(7437),a=n(759),i=n(2869),o=n(4508);function s(){let{language:e,setLanguage:t,t:n}=(0,a.Z)();return(0,r.jsxs)("div",{className:"flex items-center gap-2 mr-1",children:[(0,r.jsx)(i.z,{variant:"ghost",size:"sm",className:(0,o.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:n("footer.language.en")}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",className:(0,o.cn)("text-[11px] px-0 py-1 h-auto font-inter","text-muted-foreground"),children:n("footer.language.zh")})]})}var l=n(7648);function c(){let{t:e}=(0,a.Z)();return(0,r.jsx)("footer",{className:"mt-auto text-[11px] text-muted-foreground py-2 px-2 w-full font-inter",children:(0,r.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 font-inter",children:(0,r.jsx)(s,{})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,r.jsx)(l.default,{href:"/about",className:"text-muted-foreground font-inter",children:e("footer.links.about")}),(0,r.jsx)(l.default,{href:"/privacy",className:"text-muted-foreground font-inter",children:e("footer.links.privacy")}),(0,r.jsx)("span",{className:"text-muted-foreground font-inter",children:e("footer.copyright")})]})]})})}},8783:function(e,t,n){"use strict";n.d(t,{TK:function(){return l},Te:function(){return c},ub:function(){return d}});var r=n(7437),a=n(2869),i=n(9322),o=n(7168),s=n(759);function l(e){let{size:t="md",text:n,className:a=""}=e,{t:i}=(0,s.Z)(),o=n||i("common.loading");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(a),children:[(0,r.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-[#11295b] ".concat({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t]," mb-2")}),o&&(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:o})]})}function c(e){let{error:t,onRetry:n,retryText:l,className:c=""}=e,{t:d}=(0,s.Z)(),u=l||d("common.retry");return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(c),children:[(0,r.jsx)(i.Z,{className:"h-8 w-8 text-red-500 mb-2"}),(0,r.jsx)("p",{className:"text-red-500 mb-4 text-center",children:t}),n&&(0,r.jsxs)(a.z,{onClick:n,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4"}),u]})]})}function d(e){let{title:t,description:n,icon:a,action:i,className:o=""}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center text-center ".concat(o),children:[a&&(0,r.jsx)("div",{className:"mb-4",children:a}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),n&&(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:n}),i&&(0,r.jsx)("div",{children:i})]})}},8685:function(e,t,n){"use strict";n.d(t,{$w:function(){return o},ZX:function(){return r},iK:function(){return i},vR:function(){return a}});let r={DEFAULT_PAGE:1,DEFAULT_LIMIT:999,MAX_LIMIT:100,REQUEST_TIMEOUT:1e4,MAX_RETRIES:3},a={COLORS:{PRIMARY:"#11295b",PRIMARY_OPACITY_80:"#11295b/80",PRIMARY_OPACITY_60:"#11295b/60",GRAY_100:"bg-gray-100",GRAY_400:"text-gray-400",RED_500:"text-red-500",WHITE:"text-white"},FONTS:{POPPINS:"font-poppins",NUNITO:"font-nunito",INTER:"font-inter"},FONT_WEIGHTS:{SEMIBOLD:"font-semibold",NORMAL:"font-normal"},SIZES:{ICON_SM:"h-3.5 w-3.5",ICON_MD:"h-6 w-6",ICON_LG:"h-7 w-7",ICON_XL:"h-8 w-8"},SPACING:{GAP_2:"gap-2",GAP_4:"gap-4",MB_2:"mb-2",MB_4:"mb-4",MB_6:"mb-6",MY_4:"my-4",PX_6:"px-6",PY_2:"py-2",PY_8:"py-8",PY_12:"py-12",PB_6:"pb-6"},BORDER_RADIUS:{ROUNDED_MD:"rounded-md",ROUNDED_FULL:"rounded-full"},EFFECTS:{OPACITY_50:"opacity-50",OPACITY_80:"/80",OPACITY_60:"/60"}},i={IMAGES:{MAX_THUMBNAILS:3,DEFAULT_IMAGE:"/img/band.png",THUMBNAIL_SIZE:{width:360,height:220},THUMBNAIL_CLASS:"w-full h-28 object-cover rounded-md"},LAYOUT:{GRID_COLS_3:"grid-cols-3",MIN_HEIGHT_DVH:"min-h-dvh",FLEX_COL:"flex-col",FLEX_CENTER:"flex items-center justify-center",FLEX_BETWEEN:"flex items-center justify-between"},TEXT_SIZES:{TITLE:"text-2xl",SUBTITLE:"text-lg",BODY:"text-[15px]",SMALL:"text-sm",XS:"text-xs"}},o={SPIN:"animate-spin",FADE_IN:"animate-fade-in",SLIDE_UP:"animate-slide-up"}},6652:function(e,t,n){"use strict";n.d(t,{AK:function(){return a}});var r=n(4508);function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r.cn)(...t.filter(Boolean))}},4512:function(e,t,n){"use strict";async function r(e,t){try{if("geolocation"in navigator&&"reverseGeocode"in navigator)throw Error("浏览器不支持反向地理编码");let n=await fetch("https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(e,"&longitude=").concat(t,"&localityLanguage=zh"));if(!n.ok)throw Error("地理编码服务不可用");let r=await n.json(),a=[];return r.locality&&a.push(r.locality),r.principalSubdivision&&a.push(r.principalSubdivision),r.countryName&&a.push(r.countryName),a.join("，")||"".concat(e.toFixed(4),", ").concat(t.toFixed(4))}catch(n){return"".concat(e.toFixed(4),", ").concat(t.toFixed(4))}}async function a(e){try{let t=await function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5};return new Promise((t,n)=>{if(!navigator.geolocation){n({code:-1,message:"浏览器不支持地理位置功能"});return}navigator.geolocation.getCurrentPosition(e=>{t({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy})},e=>{let t="获取地理位置失败";switch(e.code){case e.PERMISSION_DENIED:t="用户拒绝了地理位置请求";break;case e.POSITION_UNAVAILABLE:t="地理位置信息不可用";break;case e.TIMEOUT:t="获取地理位置超时";break;default:t="获取地理位置时发生未知错误"}n({code:e.code,message:t})},e)})}(e);return await r(t.latitude,t.longitude)}catch(e){return console.warn("获取地理位置失败，使用默认位置:",e),"中国，北京"}}async function i(){if(!navigator.permissions)return"prompt";try{return(await navigator.permissions.query({name:"geolocation"})).state}catch(e){return"prompt"}}n.d(t,{gI:function(){return i},g_:function(){return a}})},3581:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},2451:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9322:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},3774:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},7168:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},function(e){e.O(0,[516,51,282,971,117,744],function(){return e(e.s=9972)}),_N_E=e.O()}]);